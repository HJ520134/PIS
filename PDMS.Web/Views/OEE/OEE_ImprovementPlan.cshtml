@model PDMS.Model.ViewModels.Fixture_DefectCodeVM
<!-- Main content -->
<section class="content portal-content">
    <!--次標題 與 搜尋-->
    <div class="row">
        <!--次標題與Search keyword-->
        <div class="col-md-12 col-lg-9">
            <h4 class="margin-td-5" id="js_search_keywords"></h4>
        </div><!-- /col-次標題與Search keyword -->
        <!--col-右方搜尋與功能按鈕列-->
        <div class="col-md-12 search-field col-lg-3">
            <a class="btn btn-primary btn-sm" data-toggle="modal" data-target="#js_search_modal"><i class="fa fa-search"></i> 查詢</a>
            <a class="btn btn-primary btn-sm" role="button" data-toggle="modal" data-target="#js_add_modal" id="js_btn_add">
                <i class="fa fa-plus"></i> 新增
            </a>
        </div><!-- /col-右方搜尋與功能按鈕列-->
    </div><!--/次標題 與 搜尋-->
    <hr class="hr-custom">

    <!--row Search Keyword collapse-->
    <div class="row">
        <div class="col-xs-12" id="js_criteria_alert_cnt">
        </div>
    </div> <!--/row Search Keyword collapse-->
    <!--內容 表格列-->
    <div class="row">
        <!--表格-->
        <div class="col-md-12 table-container">
            <table class="table table-striped table-hover table-condensed nowrap" id="js_cost_center_datatable">
                <thead>
                    <tr>
                        <th class="table-col-action nosort">Action</th>
                        <th class="table-col-seq nosort">Seq</th>
                        <th>Plant</th>
                        <th>BusinessGroup</th>
                        <th>Project</th>
                        <th>Line</th>
                        <th>Station</th>
                        <th>Machine</th>
                        <th>Action Name</th>
                        <th>Status</th>
                        <th>Requester</th>@*///Audiace*@
                        <th>Request Due Date</th>
                        <th>DRI Due Date</th>
                        <th>Close by</th> @*///Reaponse*@
                        <th>Department</th>@*///ActionID*@
                        <th>Description</th>
                        <th>Create Date</th>
                        <th>Close Date</th>
                        <th>UpdateTime</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th class="table-col-action nosort">Action</th>
                        <th class="table-col-seq nosort">Seq</th>
                        <th>Plant</th>
                        <th>BusinessGroup</th>
                        <th>Project</th>
                        <th>Line</th>
                        <th>Station</th>
                        <th>Machine</th>
                        <th>Action Name</th>
                        <th>Status</th>
                        <th>Requester</th>@*///Audiace*@
                        <th>Request Due Date</th>
                        <th>DRI Due Date</th>
                        <th>Close by</th> @*///Reaponse*@
                        <th>Department</th>@*///ActionID*@
                        <th>Description</th>
                        <th>Create Date</th>
                        <th>Close Date</th>
                        <th>UpdateTime</th>
                    </tr>
                </tfoot>
            </table>
            <div id="page" class="row"></div>

        </div><!--/表格-->
    </div><!-- / 內容 表格列 -->


</section><!-- /.content -->
@section ViewModals{
    <!-- Search Modal -->
    <div class="modal fade" id="js_search_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">查詢</h4>
                </div>
                <div class="modal-body">
                    <form id="js_form_query" class="form-horizontal" data-need-validate="true">
                        <h4>
                            <label style="font-size:18px">Select BaseInfo</label>
                        </h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_select_factory">Plant</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_factory" name="Plant_Organization_UID" data-live-search="true">
                                            @foreach (var item in Model.Plants)
                                            {
                                                <option value=@item.Plant_OrganizationUID>@item.Plant</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_select_op_type">BusinessGroup</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_op_type" name="BG_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_select_fun_plant">FuntPlant</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_fun_plant" name="FunPlant_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_customerId">Project</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_customerId" name="Project_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_s_select_line_id"> Line</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_line_id" name="LineID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_select_station_id">Station</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_station_id" name="Station_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_select_machine_id">Machine</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_machine_id" name="Machine_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_select_meeting_type_id">Meeting Type</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_meeting_type_id" name="MeetingType_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_status_id">Status</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_s_status_id" name="Status" data-live-search="true">
                                            <option value=0 selected></option>
                                            <option value=1>1-Open开单</option>
                                            <option value=2 tyle="color:#FFFF00">2-WIP正在进行</option>
                                            <option value=3 tyle="color:#FF0000">3-Delay延迟</option>
                                            <option value=4 tyle="color:#00FF00">4-Close结案</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h4>
                            <label style="font-size:18px">Action BaseInfo</label>
                        </h4>
                        <hr />
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_input_audience"> Requester</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control input-sm" id="js_s_input_audience" name="Audience" placeholder="Requester"
                                               data-rule-maxlength="50" data-msg-maxlength="Please enter no more than {0} characters in Action Name.">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"> Create Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="Created_Date" class="form-control input-sm date" id="js_s_commit_date_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"> Request Due Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="Due_Date" class="form-control input-sm date" id="js_s_input_due_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"> DRI Due Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="DirDueDate" class="form-control input-sm date" id="js_s_input_DirDueDate">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_improvementplanId_id"> Department</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="ImprovementPlan_ID" class="form-control input-sm" id="js_s_improvementplanId_id" maxlength="20" placeholder="Department">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_s_input_responsible"> Close by</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="Responsible" class="form-control input-sm" id="js_s_input_responsible" placeholder="Close by">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label no-padding-hr" for="js_s_improvementplan_name_id">  Action Name</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control input-sm" id="js_s_improvementplan_name_id" name="ImprovementPlan_Name" placeholder="Action Name">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"> Close Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="Close_Date" class="form-control input-sm date" id="js_s_input_close_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-sm" id="js_btn_clear"><i class="fa fa-eraser"></i> Clear</button>
                    <button type="button" class="btn btn-primary btn-sm" id="js_btn_query"><i class="fa fa-search"></i> Query</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Modal -->
    <div class="modal fade" id="js_add_modal" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">新增</h4>
                </div>
                <div class="modal-body">
                    <form id="js_form_add" class="form-horizontal" data-need-validate="true">
                        <input type="hidden" id="hidImprovementPlan_UID" name="ImprovementPlan_UID" />
                        <h4>
                            <label style="font-size:18px">Select  BaseInfo</label>
                        </h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_select_factory"><span style="color:red;text-align:center">*</span> Plant</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_factory" name="Plant_Organization_UID" data-live-search="true">
                                            <option></option>
                                            @foreach (var item in Model.Plants)
                                            {
                                                <option value=@item.Plant_OrganizationUID>@item.Plant</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_select_op_type"><span style="color:red;text-align:center">*</span> BusinessGroup</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_op_type" name="BG_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_select_fun_plant"><span style="color:red;text-align:center">*</span> FunctionPlant</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_fun_plant" name="FunPlant_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_customerId"><span style="color:red;text-align:center">*</span> Project</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_customerId" name="Project_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_a_select_line_id"><span style="color:red;text-align:center">*</span> Line</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_line_id" name="LineID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_select_station_id"><span style="color:red;text-align:center">*</span> Station</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_station_id" name="Station_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_select_machine_id"><span style="color:red;text-align:center">*</span> Machine</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_machine_id" name="Machine_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_select_meeting_type_id"><span style="color:red;text-align:center">*</span> Meeting Type</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_meeting_type_id" name="MeetingType_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_status_id"><span style="color:red;text-align:center">*</span> Status</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_status_id" name="Status" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h4>
                            <label style="font-size:18px">Action BaseInfo</label>
                        </h4>
                        <hr />
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_input_audience"><span style="color:red;text-align:center">*</span> Requester</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control input-sm" id="js_a_input_audience" maxlength="20" name="Audience" placeholder="Requester"
                                               data-rule-maxlength="50" data-msg-maxlength="Please enter no more than {0} characters in Action Name.">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" id="div_createtime" hidden="hidden">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"><span style="color:red;text-align:center">*</span> Create Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="Created_Date" class="form-control input-sm date" id="js_a_commit_date_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" id="div_dueDate">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"><span style="color:red;text-align:center">*</span> Request Due Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="Due_Date" class="form-control input-sm date" id="js_a_input_due_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" id="div_driduedate" hidden="hidden">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"><span style="color:red;text-align:center">*</span> DRI Due Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="DirDueDate" class="form-control input-sm date" id="js_a_input_DirDueDate">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_improvementplanId_id"><span style="color:red;text-align:center">*</span> Department</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="ImprovementPlan_ID" class="form-control input-sm" id="js_a_improvementplanId_id" maxlength="20" placeholder="Department">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_input_responsible"><span style="color:red;text-align:center">*</span> Close by</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="Responsible" class="form-control input-sm" maxlength="20" id="js_a_input_responsible" placeholder="Close by">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6" id="div_closedate" hidden="hidden">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" data-type="date-interval"><span style="color:red;text-align:center">*</span> Close Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <input type="text" name="Close_Date" class="form-control input-sm date" id="js_a_input_close_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label no-padding-hr" for="js_a_improvementplan_name_id"><span style="color:red;text-align:center">*</span> Action Name</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control input-sm" id="js_a_improvementplan_name_id" name="ImprovementPlan_Name" placeholder="Action Name">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label no-padding-hr" for="js_a_input_problemdescription_id"><span style="color:red;text-align:center">*</span> Problem Description</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" rows="2" maxlength="150" id="js_a_input_problemdescription_id" name='Problem_Description'></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label no-padding-hr" for="js_a_root_cause"> Root_Cause</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" rows="2" maxlength="150" id="js_a_root_cause" name=Root_Cause></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-2  control-label no-padding-hr" for="js_a_cacp_description"> Solutions</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" rows="2" maxlength="150" id="js_a_cacp_description" name="CACP_Description"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-2  control-label no-padding-hr" for="js_a_comment"> Remarks</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" rows="2" maxlength="150" id="js_a_comment" name="Comment"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h4>
                            <label style="font-size:18px">Metric Details</label>
                        </h4>
                        <hr />
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-hr" for="js_a_select_metric_id"><span style="color:red;text-align:center">*</span> Metric</label>
                                    <div class="col-sm-8">
                                        <select class="selectpicker form-control input-sm" id="js_a_select_metric_id" name="Metric_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div style="float:right;padding-right:18px">
                                <button type="button" class="btn btn-primary btn-sm" id="bt_add_mat">
                                    <i class=" fa fa-plus"></i> Add
                                </button>
                                <button type="button" class="btn  btn-primary btn-sm" id="bt_remove_mat">
                                    <i class="fa fa-times"> </i> Delete
                                </button>
                            </div>
                        </div>
                        <table class="table table-condensed" id="js_metrice_datatable_detail">
                            <thead>
                                <tr>
                                    <th class="table-col-checkbox nosort">
                                        <input type="checkbox" class="js-checkbox-all" />
                                    </th>
                                    <th class="padding-l-5-i">Seq</th>
                                    <th class="padding-l-5-i">Metric ID </th>
                                    <th class="padding-l-5-i">Metric Name</th>
                                </tr>
                            </thead>
                        </table>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-sm" data-dismiss="modal" id="js_btn_cancel"><i class="fa fa-times"></i> Cancel</button>
                    <button type="button" class="btn btn-primary btn-sm" id="js_btn_save_new"><i class="fa fa-save"></i> Save</button>
                    <button type="button" class="btn btn-primary btn-sm" id="js_btn_save_edit"><i class="fa fa-save"></i> Edit Save</button>
                </div>
            </div>
        </div>
    </div>
}

<div class="col-md-8 pull-right" style="height:40px;margin-top:15px; display:inline">
    <div class="col-md-5 pull-right" style="width:80%;margin-right:-14%">
        <div id="Aboustatus">
            <div style="background-color:#7dc8f3;width:150px;float:left;font-size:12px; text-align: center;line-height:28px;height:28px;color:#ffffff;" title="@T(" 1-Open(开单)")">
                @T("Open(开单)")
            </div>
            <div style="background-color:#72b362;width:150px;font-size:12px;margin-left:0px;text-align: center ;line-height:28px;height:28px;float:left;color:#ffffff;" title="@T(" 2-WIP(进行中)")">
                @T("WIP(进行中)")
            </div>
            <div style="background-color:#db4844;width:150px;margin-left:0px;font-size:12px;text-align: center ; line-height:28px;height:28px;float:left;color:#ffffff;" title="@T(" 3-Delay(延迟)")">
                @T("Delay(延迟)")
            </div>
            <div style="background-color:#c4c4c4;width:150px;margin-left:0px;font-size:12px;text-align: center ; line-height:28px;height:28px;float:left;color:#ffffff;" title="@T(" 4-Close(结案)")">
                @T("Close(结案)")
            </div>
        </div>
    </div>
</div>

<style>
    input.fullWidth {
        width: 100% !important;
    }
</style>
@section ViewScripts{
    <script type="text/javascript" src="~/Scripts/PDMSJS/Common.js"></script>
    <link rel="stylesheet" type="text/css" href="~/Content/css/bootstrap-select.css" />
    <script type="text/javascript" src="~/Scripts/EQP/bootstrap-select.js"></script>

    <script type="text/javascript">
        $(function () {
            //OEE Metrices
            METRICES_ONEDATA = TAFFY();

            var Metrices = (function () {
                var urls = {
                    GetImprovementPlan: '@Url.Action("GetImprovementPlan", "OEE")',
                    GetImprovementPlanById: '@Url.Action("GetImprovementPlanById", "OEE")',
                    DeleteImpeovementPlanById: '@Url.Action("DeleteImpeovementPlanById", "OEE")',

                    getPlants: '@Url.Action("GetPlantsUseSettingsAPI", "GoldenLine")',
                    getOPType: '@Url.Action("GetOPTypeUseFixtureAPI", "GoldenLine")',
                    getFunPlant: '@Url.Action("GetFunPlantUseFixtureAPI", "GoldenLine")',
                    getFunPlantByOPTypes: '@Url.Action("GetFunPlantByOPTypes", "Fixture")',
                    getCustomerDTOs: '@Url.Action("GetCustomerDTOs", "GoldenLine")',
                    //根据专案ID获取线的信息GetLineDTOs(int CustomerID)
                    getLineDTOs: '@Url.Action("GetLineDTOs", "OEE")',
                    //根据线的ID获取站的信息 GetStationDTOs(int LineId)
                    getStationDTOs: '@Url.Action("GetStationDTOs", "OEE")',
                    //根据线的ID获取站的信息 GetStationDTOs(int LineId)
                    getMachineDTOs: '@Url.Action("GetAllByStationID", "OEE")',
                    //获取会议的名称
                    getMeetingTypeName: '@Url.Action("GetMeetingTypeName", "OEE")',
                    //获取Metrices 名称
                    GetMetricName: '@Url.Action("GetMetricName", "OEE")',
                }
                var columns = [
                        {
                            data: null,
                            createdCell: function (td, cellData, rowData, row, col) {
                                var result = '<button class="btn btn-primary btn-xs" rel="action-popover">' +
                                        '<i class="fa fa-reorder"></i>' +
                                        '</button>' +
                                        '<div class="hidden popover-content">' +
                                            '{0}' +
                                            '{1}' +
                                            '{2}' +
                                        '</div>';
                                var buttonView = '<button type="button" class="btn btn-primary btn-xs js-grid-view"  data-nid=' + rowData.ImprovementPlan_UID + '>查看</button>';
                                var buttonEdit = '<button type="button" class="btn btn-primary btn-xs js-grid-edit"  data-nid=' + rowData.ImprovementPlan_UID + '>编辑</button>';
                                var buttonDelete = '<button type="button" class="btn btn-primary btn-xs js-grid-Delete"  data-nid=' + rowData.ImprovementPlan_UID + '>删除</button>';
                                result = result.replace('{0}', buttonView);
                                if (rowData.Status == 1 || rowData.Status == 2) {
                                    result = result.replace('{1}', buttonEdit);
                                    result = result.replace('{2}', buttonDelete);
                                    $(td).html(result);
                                }
                                if (rowData.Status == 4) {
                                    result = result.replace('{1}', '');
                                    result = result.replace('{2}', '');
                                    $(td).html(result);
                                } else {
                                    result = result.replace('{1}', buttonEdit);
                                    result = result.replace('{2}', '');
                                    $(td).html(result);
                                }
                            },
                            className: "text-center"
                        },
                        {
                            data: null,
                            className: "table-col-seq"
                        },
                        {
                            data: "Plant_Organization_Name",
                            className: "text-center"
                        },
                        {
                            data: "BG_Organization_Name",
                            className: "text-center"
                        },
                        {
                            data: "ProjectName",
                            className: "text-center"
                        },
                        {
                            data: "LineName",
                            className: "text-center"
                        },
                        {
                            data: "StationName",
                            className: "text-center"
                        },
                        {
                            data: "MachineName",
                            className: "text-center"
                        },

                        {
                            data: "ImprovementPlan_Name",
                            className: "text-center"
                        },
                        {
                            data: "Status",
                            createdCell: function (td, cellData, rowData, row, col) {
                                var htmlText = '';
                                if (rowData.Status == 1) {
                                    $(td).html('<i class="fa fa-circle" style="color:#7dc8f3"></i>');
                                } else if (rowData.Status == 2) {
                                    $(td).html('<i class="fa fa-circle" style="color:#72b362"></i>');
                                }
                                else if (rowData.Status == 3) {
                                    $(td).html('<i class="fa fa-circle" style="color:#db4844"></i>');
                                }
                                else if (rowData.Status == 4) {
                                    $(td).html('<i class="fa fa-circle" style="color:#c4c4c4"></i>');
                                }
                            },
                            className: "text-center"
                        },
                        {
                            data: "Audience",
                            className: "text-center"
                        },
                        {
                            data: null,
                            createdCell: function (td, cellData, rowData, row, col) {
                                if ((rowData.Due_Date == '') || (new Date(rowData.Due_Date).Format("yyyy-MM-dd") == '1900-01-01')) {
                                    $(td).html('');
                                } else {
                                    $(td).html(new Date(rowData.Due_Date).Format("yyyy-MM-dd hh:mm"));
                                }
                            },
                            className: "text-center"
                        },
                               {
                                   data: null,
                                   createdCell: function (td, cellData, rowData, row, col) {
                                       if ((rowData.DirDueDate == '') || rowData.DirDueDate==null || (new Date(rowData.DirDueDate).Format("yyyy-MM-dd") == '1900-01-01')) {
                                           $(td).html('');
                                       } else {
                                           $(td).html(new Date(rowData.DirDueDate).Format("yyyy-MM-dd hh:mm"));
                                       }
                                   },
                                   className: "text-center"
                               },
                        {
                            data: "Responsible",
                            className: "text-center"
                        },
                              {
                                  data: "ImprovementPlan_ID",
                                  className: "text-center"
                              },

                        {
                            data: "Problem_Description",
                            className: "text-center"
                        },
                        {
                            data: null,
                            createdCell: function (td, cellData, rowData, row, col) {
                                if ((rowData.Created_Date == '') || rowData.Created_Date == null || (new Date(rowData.Created_Date).Format("yyyy-MM-dd") == '1900-01-01')) {
                                    $(td).html('');
                                } else {
                                    $(td).html(new Date(rowData.Created_Date).Format("yyyy-MM-dd hh:mm"));
                                }
                            },
                            className: "text-center"
                        },

              {
                  data: null,
                  createdCell: function (td, cellData, rowData, row, col) {
                      if ((rowData.Close_Date == '') || rowData.Close_Date == null || new Date(rowData.Close_Date).Format("yyyy-MM-dd") == '1900-01-01') {
                          $(td).html('');
                      } else {
                          $(td).html(new Date(rowData.Close_Date).Format("yyyy-MM-dd hh:mm"));
                      }
                  },
                  className: "text-center"
              },
                              {
                                  data: null,
                                  createdCell: function (td, cellData, rowData, row, col) {
                                      if ((rowData.Commit_Date == '') || rowData.Commit_Date == null || new Date(rowData.Commit_Date).Format("yyyy-MM-dd") == '1900-01-01') {
                                          $(td).html('');
                                      } else {
                                          $(td).html(new Date(rowData.Commit_Date).Format("yyyy-MM-dd hh:mm"));
                                      }
                                  },
                                  className: "text-center"
                              }
                ];
                Date.prototype.Format = function (fmt) { //author: meizz
                    var o = {
                        "M+": this.getMonth() + 1, //月份
                        "d+": this.getDate(), //日
                        "h+": this.getHours(), //小时
                        "m+": this.getMinutes(), //分
                        "s+": this.getSeconds(), //秒
                        "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                        "S": this.getMilliseconds() //毫秒
                    };
                    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                    for (var k in o)
                        if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                    return fmt;
                }

                var _getParams = function () {
                    PDMS.Utility.Settings.Pages.remote.params = $('#js_form_query').serialize().replace(/\+/g, " ");
                    return $('#js_form_query').serialize().replace(/\+/g, " ");
                };

                var _queryPurchase = function (firstLoad) {
                    if (firstLoad) {
                        $('#js_s_commit_date_date').val(new Date().Format("yyyy-MM-dd hh:mm"));
                    }
                    var config = {
                        pageId: "#page",
                        tableId: "#js_cost_center_datatable",
                        remoteUrl: urls.GetImprovementPlan,
                        searchParams: _getParams(),
                        tableOptions: {
                            scrollX: true,
                            autoWidth: true,
                            columns: columns
                        }
                    };
                    if (!firstLoad) {
                        $('#page').page('destroy');
                        PDMS.Utility.Criteria.Build();
                    }
                    var chk_value = [];
                    table = PDMS.Utility.ReturnDataTable.Set(config, chk_value);
                }

                return {
                    urls: urls,
                    Init: function () {
                        PDMS.Utility.Criteria.Init();
                        _queryPurchase(true);
                    },
                    QueryPurchase: function () {
                        _queryPurchase(false);
                    }
                }
            })();

            Metrices.Init();

            //查询
            $('#js_btn_query').click(function () {
                Metrices.QueryPurchase();
                $('#js_search_modal').modal('hide');
            });

            var GetDetailColumn = function () {
                var subcolumns = [
                     {
                         data: null, //不绑定数据列，需要添加此行
                         createdCell: function (td, cellData, rowData, row, col) {
                             $(td).html('<input type="checkbox" name="cktrans" class="js-checkbox-item" value="' + rowData.Metric_UID + '">')
                                 .addClass('table-col-checkbox');
                         },
                         className: "text-center"
                     },
                {
                    data: null,
                    render: function (data, type, row, rowIndex) {
                        var index = rowIndex.row + 1;
                        return index;
                    },
                }, {
                    data: "Metric_ID",
                    className: "min-col-xs"
                }, {
                    data: "Metric_Name",
                    className: "min-col-xs"
                }
                ];
                return subcolumns;
            }
            subTable = $('#js_metrice_datatable_detail').DataTable({
                columns: GetDetailColumn(),
                ordering: false,
                data: [],
                destroy: true
            });

            //refreplant();
            function refreplant() {
                var url = Metrices.urls.getPlants;
                $.post(url, function (data) {
                    $('#js_s_select_factory').html('<option></option>');
                    $('#js_a_select_factory').html('<option></option>');
                    for (var i = 0; i < data.length; i++) {
                        //查詢頁
                        if ($('#js_s_select_factory').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                            $('#js_s_select_factory').append('<option value="' + data[i].Organization_UID + '">' + data[i].Organization_Name + '</option>');
                        }
                        //新增/編輯頁
                        if ($('#js_a_select_factory').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                            $('#js_a_select_factory').append('<option value="' + data[i].Organization_UID + '">' + data[i].Organization_Name + '</option>');
                        }
                    }

                    $('#js_s_select_factory').selectpicker('refresh');
                    $('#js_a_select_factory').selectpicker('refresh');

                });
            }

            //厂区变更.新增
            $('#js_a_select_factory').change(function () {
                var oporgid = $('#js_a_select_factory option:selected').val();

                $('#js_a_select_op_type').html('<option></option>');
                $('#js_a_select_op_type').selectpicker('refresh');

                $('#js_a_select_fun_plant').html('<option></option>');
                $('#js_a_select_fun_plant').selectpicker('refresh');

                $('#js_a_customerId').html('<option></option>');
                $('#js_a_customerId').selectpicker('refresh');

                $('#js_a_select_line_id').html('<option></option>');
                $('#js_a_select_line_id').selectpicker('refresh');

                $('#js_a_select_station_id').html('<option></option>');
                $('#js_a_select_station_id').selectpicker('refresh');

                $('#js_a_select_machine_id').html('<option></option>');
                $('#js_a_select_machine_id').selectpicker('refresh');

                if (oporgid != 0) {
                    refrefactory(oporgid);
                }
            })

            //厂区变更.查询
            $('#js_s_select_factory').change(function () {
                var oporgid = $('#js_s_select_factory option:selected').val();
                $('#js_s_select_op_type').html('<option></option>');
                $('#js_s_select_op_type').selectpicker('refresh');

                $('#js_s_select_fun_plant').html('<option></option>');
                $('#js_s_select_fun_plant').selectpicker('refresh');

                $('#js_s_customerId').html('<option></option>');
                $('#js_s_customerId').selectpicker('refresh');

                $('#js_s_select_line_id').html('<option></option>');
                $('#js_s_select_line_id').selectpicker('refresh');

                $('#js_s_select_station_id').html('<option></option>');
                $('#js_s_select_station_id').selectpicker('refresh');

                $('#js_s_select_machine_id').html('<option></option>');
                $('#js_s_select_machine_id').selectpicker('refresh');

                if (oporgid != 0) {
                    refrefactory(oporgid);
                }
            })

            function refrefactory(oporgid) {
                url = Metrices.urls.getOPType;
                $.post(url, { plant_OrganizationUID: oporgid }, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        if ($('#js_a_select_op_type').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                            $('#js_a_select_op_type').append('<option value="' + data[i].Organization_UID + '">' + data[i].OP_TYPES + '</option>');
                        }

                        if ($('#js_s_select_op_type').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                            $('#js_s_select_op_type').append('<option value="' + data[i].Organization_UID + '">' + data[i].OP_TYPES + '</option>');
                        }
                    }
                    $('#js_a_select_op_type').selectpicker('refresh');
                    $('#js_s_select_op_type').selectpicker('refresh');
                });
            }

            //BG 类型变更
            $('#js_a_select_op_type').change(function () {

                $('#js_a_select_fun_plant').html('<option></option>');
                $('#js_a_select_fun_plant').selectpicker('refresh');

                $('#js_a_customerId').html('<option></option>');
                $('#js_a_customerId').selectpicker('refresh');

                $('#js_a_select_line_id').html('<option></option>');
                $('#js_a_select_line_id').selectpicker('refresh');

                $('#js_a_select_station_id').html('<option></option>');
                $('#js_a_select_station_id').selectpicker('refresh');

                $('#js_a_select_machine_id').html('<option></option>');
                $('#js_a_select_machine_id').selectpicker('refresh');

                if ($('#js_a_select_op_type').val() != "") {
                    refreOpType($('#js_a_select_op_type').val(), $('#js_a_select_op_type option:selected').text());
                }
                refreshSearchFuncPlantSelect($('#js_a_select_op_type').val());
                refreshSearchProjectSelect($('#js_a_select_op_type').val());
            })

            //BG 类型变更.查询
            $('#js_s_select_op_type').change(function () {

                $('#js_s_select_fun_plant').html('<option></option>');
                $('#js_s_select_fun_plant').selectpicker('refresh');

                $('#js_s_customerId').html('<option></option>');
                $('#js_s_customerId').selectpicker('refresh');

                $('#js_s_select_line_id').html('<option></option>');
                $('#js_s_select_line_id').selectpicker('refresh');

                $('#js_s_select_station_id').html('<option></option>');
                $('#js_s_select_station_id').selectpicker('refresh');

                $('#js_s_select_machine_id').html('<option></option>');
                $('#js_s_select_machine_id').selectpicker('refresh');

                if ($('#js_s_select_op_type').val() != "") {
                    refreOpType($('#js_s_select_op_type').val(), $('#js_s_select_op_type option:selected').text());

                    ///获取会议名称
                    var meetUrl = Metrices.urls.getMeetingTypeName;
                    $.post(meetUrl, { plantUid: $('#js_s_select_factory option:selected').val(), bgUid: $('#js_s_select_op_type option:selected').val(), funplantUid: $('#js_s_select_fun_plant option:selected').val() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_s_select_meeting_type_id').find('option[value=' + data[i].MeetingType_UID + ']').length == 0) {
                                $('#js_s_select_meeting_type_id').append('<option value="' + data[i].MeetingType_UID + '">' + data[i].MeetingType_Name + '</option>');
                            }
                        }
                        $('#js_s_select_meeting_type_id').selectpicker('refresh');
                    });

                    ///获取Metrice 名称
                    var metriceUrl = Metrices.urls.GetMetricName;
                    $.post(metriceUrl, { plantUid: $('#js_s_select_factory option:selected').val(), bgUid: $('#js_s_select_op_type option:selected').val(), funplantUid: $('#js_s_select_fun_plant option:selected').val() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_s_select_metric_id').find('option[value=' + data[i].Metric_UID + ']').length == 0) {
                                $('#js_s_select_metric_id').append('<option value="' + data[i].Metric_ID + '_' + data[i].Metric_UID + '_' + data[i].Metric_Name + '">' + data[i].Metric_Name + '</option>');
                            }
                        }
                        $('#js_s_select_metric_id').selectpicker('refresh');
                    });
                }
                refreshSearchFuncPlantSelect($('#js_s_select_op_type').val());
                refreshSearchProjectSelect($('#js_s_select_op_type').val());
            })

            ///OP变更
            function refreOpType(oporgid, optypes) {
                var url = Metrices.urls.getFunPlant;
                var get_customer_id_url = Metrices.urls.getCustomerDTOs;
                ///获取会议名称
                var meetUrl = Metrices.urls.getMeetingTypeName;
                $.post(meetUrl, { plantUid: $('#js_a_select_factory option:selected').val(), bgUid: $('#js_a_select_op_type option:selected').val(), funplantUid: $('#js_a_select_fun_plant option:selected').val() }, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        if ($('#js_a_select_meeting_type_id').find('option[value=' + data[i].MeetingType_UID + ']').length == 0) {
                            $('#js_a_select_meeting_type_id').append('<option value="' + data[i].MeetingType_UID + '">' + data[i].MeetingType_Name + '</option>');
                        }

                        if ($('#js_s_select_meeting_type_id').find('option[value=' + data[i].MeetingType_UID + ']').length == 0) {
                            $('#js_s_select_meeting_type_id').append('<option value="' + data[i].MeetingType_UID + '">' + data[i].MeetingType_Name + '</option>');
                        }
                    }
                    $('#js_a_select_meeting_type_id').selectpicker('refresh');
                    $('#js_s_select_meeting_type_id').selectpicker('refresh');
                });

                ///获取Metrice 名称
                var metriceUrl = Metrices.urls.GetMetricName;
                $.post(metriceUrl, { plantUid: $('#js_a_select_factory option:selected').val(), bgUid: $('#js_a_select_op_type option:selected').val(), funplantUid: $('#js_a_select_fun_plant option:selected').val() }, function (data) {
                    $('#js_a_select_metric_id').empty();
                    for (var i = 0; i < data.length; i++) {
                        if ($('#js_a_select_metric_id').find('option[value=' + data[i].Metric_UID + ']').length == 0) {
                            $('#js_a_select_metric_id').append('<option value="' + data[i].Metric_ID + '_' + data[i].Metric_UID + '_' + data[i].Metric_Name + '">' + data[i].Metric_Name + '</option>');
                        }
                    }
                    $('#js_a_select_metric_id').selectpicker('refresh');
                });
            }

            //加载功能厂
            function refreshSearchFuncPlantSelect(Optype) {
                $('#js_a_select_fun_plant').html('<option></option>');
                $('#js_a_select_fun_plant').selectpicker('refresh');
                var url = Metrices.urls.getFunPlantByOPTypes;
                $.post(url, { Optype: Optype }, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        $('#js_a_select_fun_plant').append('<option value="' + data[i].FunPlant_OrganizationUID + '">' + data[i].FunPlant + '</option>');
                        $('#js_s_select_fun_plant').append('<option value="' + data[i].FunPlant_OrganizationUID + '">' + data[i].FunPlant + '</option>');
                    }

                    $('#js_a_select_fun_plant').selectpicker('refresh');
                    $('#js_s_select_fun_plant').selectpicker('refresh');
                });
            }

            //加载专案
            function refreshSearchProjectSelect(optypeUid) {
                $('#js_a_customerId').html('<option></option>');
                $('#js_a_customerId').selectpicker('refresh');
                var getProjectByOPTypeUrl = Metrices.urls.getCustomerDTOs;
                $.get(getProjectByOPTypeUrl, { BG_Organization_UID: optypeUid }, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        $('#js_a_customerId').append('<option value="' + data[i].Project_UID + '">' + data[i].Project_Name + '</option>');
                        $('#js_s_customerId').append('<option value="' + data[i].Project_UID + '">' + data[i].Project_Name + '</option>');
                    }
                    $('#js_a_customerId').selectpicker('refresh');
                    $('#js_s_customerId').selectpicker('refresh');
                });
            }

            //主頁功能廠變更
            $('#js_m_select_fun_plant').change(function () {
                $('#js_m_select_group_line').html('<option></option>');
                $('#js_m_select_group_line').selectpicker('refresh');
                if ($('#js_m_select_fun_plant').val() != "") {
                    var get_group_line_url = Metrices.urls.getGroupLine;
                    $.post(get_group_line_url, { oporgid: $('#js_m_select_factory').val(), optypes: $('#js_m_select_op_type').val(), opFunPlant: $('#js_m_select_fun_plant').val() }, function (data) {
                        $('#js_m_select_group_line').html('<option></option>');
                        for (var i = 0; i < data.length; i++) {
                            //主頁
                            if ($('#js_m_select_group_line').find('option[value=' + data[i].LineGroup_UID + ']').length == 0) {
                                $('#js_m_select_group_line').append('<option value="' + data[i].LineGroup_UID + '">' + data[i].LineName + '</option>');
                            }
                        }
                        $('#js_m_select_group_line').selectpicker('refresh');
                    });
                }
            })

            //根据专案获取线别
            $('#js_a_customerId').change(function () {
                $('#js_a_select_line_id').html('<option></option>');
                $('#js_a_select_line_id').selectpicker('refresh');
                $('#js_a_select_station_id').html('<option></option>');
                $('#js_a_select_station_id').selectpicker('refresh');
                $('#js_a_select_machine_id').html('<option></option>');
                $('#js_a_select_machine_id').selectpicker('refresh');
                refreLine($('#js_a_customerId option:selected').val());
            })

            //根据专案获取线别.查询
            $('#js_s_customerId').change(function () {
                $('#js_s_select_line_id').html('<option></option>');
                $('#js_s_select_line_id').selectpicker('refresh');
                $('#js_s_select_station_id').html('<option></option>');
                $('#js_s_select_station_id').selectpicker('refresh');
                $('#js_s_select_machine_id').html('<option></option>');
                $('#js_s_select_machine_id').selectpicker('refresh');
                refreLine($('#js_s_customerId option:selected').val());
            })

            function refreLine(customerId) {
                var getProjectByOPTypeUrl = Metrices.urls.getLineDTOs;
                $.get(getProjectByOPTypeUrl, { customerId: customerId }, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        $('#js_a_select_line_id').append('<option value="' + data[i].LineID + '">' + data[i].LineName + '</option>');
                        $('#js_s_select_line_id').append('<option value="' + data[i].LineID + '">' + data[i].LineName + '</option>');
                    }
                    $('#js_a_select_line_id').selectpicker('refresh');
                    $('#js_s_select_line_id').selectpicker('refresh');
                });
            }

            //根据线获取站点
            $('#js_a_select_line_id').change(function () {
                $('#js_a_select_station_id').html('<option></option>');
                $('#js_a_select_station_id').selectpicker('refresh');
                $('#js_a_select_machine_id').html('<option></option>');
                $('#js_a_select_machine_id').selectpicker('refresh');
                refreStation($('#js_a_select_line_id option:selected').val());
            })

            //根据线获取站点.查询
            $('#js_s_select_line_id').change(function () {
                $('#js_s_select_station_id').html('<option></option>');
                $('#js_s_select_station_id').selectpicker('refresh');
                $('#js_s_select_machine_id').html('<option></option>');
                $('#js_s_select_machine_id').selectpicker('refresh');
                refreStation($('#js_s_select_line_id option:selected').val());
            })

            function refreStation(LineId) {
                var getProjectByOPTypeUrl = Metrices.urls.getStationDTOs;
                $.get(getProjectByOPTypeUrl, { LineId: LineId }, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        $('#js_a_select_station_id').append('<option value="' + data[i].StationID + '">' + data[i].StationName + '</option>');
                        $('#js_s_select_station_id').append('<option value="' + data[i].StationID + '">' + data[i].StationName + '</option>');
                    }
                    $('#js_a_select_station_id').selectpicker('refresh');
                    $('#js_s_select_station_id').selectpicker('refresh');
                });
            }
            //根据站点获取机台
            $('#js_a_select_station_id').change(function () {
                $('#js_a_select_machine_id').html('<option></option>');
                $('#js_a_select_machine_id').selectpicker('refresh');
                refreMachine($('#js_a_select_station_id option:selected').val());
            })

            //根据站点获取机台.查询
            $('#js_s_select_station_id').change(function () {
                $('#js_s_select_machine_id').html('<option></option>');
                $('#js_s_select_machine_id').selectpicker('refresh');
                refreMachine($('#js_s_select_station_id option:selected').val());
            })

            function refreMachine(stationUID) {
                var getProjectByOPTypeUrl = Metrices.urls.getMachineDTOs;
                $.get(getProjectByOPTypeUrl, { stationUID: stationUID }, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        $('#js_a_select_machine_id').append('<option value="' + data[i].OEE_MachineInfo_UID + '">' + data[i].MachineNo + '</option>');
                        $('#js_s_select_machine_id').append('<option value="' + data[i].OEE_MachineInfo_UID + '">' + data[i].MachineNo + '</option>');
                    }
                    $('#js_a_select_machine_id').selectpicker('refresh');
                    $('#js_s_select_machine_id').selectpicker('refresh');
                });
            }

            ///隐藏modal框时清空值
            $('#js_btn_clear').on('click', function (e) {
                ClearSelect();
            });

            function ClearSelect() {
                $('#js_search_modal').find('input').val('');
                $('#js_search_modal').find('textarea').val('');
                var $searchform = $('#js_form_query');

                //$searchform.each(function () {
                //    $(this).val('');
                //})

                $searchform.find("select").each(function () {
                    $(this).find("option").attr("selected", false);
                    $(this).selectpicker('refresh');
                });
                PDMS.Utility.Criteria.Clear();
            }

            ///点击新增按钮
            $('#bt_add_mat').click(function () {
                if ($('#js_a_select_op_type').val() == '') {
                    PDMS.Utility.MessageBox.info("请输入OP类型");
                    return false;
                }
                var metricInfo = $('#js_a_select_metric_id').val();
                var isValid = true;
                var errorMessage = "";
                //验证已有的数据是否填写完整
                METRICES_ONEDATA().each(function (item) {
                    //if (item.Price == "" || item.Price == undefined || item.Price == 0) {
                    //    errorMessage += '请完成采购单配件明细区第 #' + item.index + "行[采购单价];  ";
                    //    isValid = false;
                    //}
                });

                if (!isValid) {
                    if (errorMessage != "") {
                        PDMS.Utility.MessageBox.info(errorMessage);
                    }
                    return false;
                }

                var valueStr = metricInfo.split('_');
                //检查添加的配件是否已经在临时表存在
                var hasItem = METRICES_ONEDATA({ Metric_UID: parseInt(valueStr[1]) }).first();
                if (hasItem) {
                    PDMS.Utility.MessageBox.info('新加的Metric 已经存在');
                    return false;
                }

                if (metricInfo != null && metricInfo.length > 0) {

                    //如果不是第一笔数据则取最大值加1
                    var index = 1;
                    if (METRICES_ONEDATA().last()) {
                        index = METRICES_ONEDATA().last().index + 1;
                    }

                    var paramItem = {};
                    paramItem["index"] = index;
                    paramItem["Metric_ID"] = valueStr[0];
                    paramItem["Metric_UID"] = parseInt(valueStr[1]);
                    paramItem["Metric_Name"] = valueStr[2];
                    paramItem["ImprovementPlan_UID"] = valueStr[3];

                    METRICES_ONEDATA.insert({
                        index: index,
                        ImprovementPlan_UID: paramItem.ImprovementPlan_UID,
                        Metric_ID: paramItem.Metric_ID,
                        Metric_UID: paramItem.Metric_UID,
                        Metric_Name: paramItem.Metric_Name,
                    });

                    var row = subTable.row.add(paramItem).draw();
                }
            });

            /// 修改保存 js_btn_save_edit
            $('#js_btn_save_edit').click(function () {
                $('#js_a_input_DirDueDate').removeAttr("disabled");

                if ($('#js_a_select_factory').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择厂区");
                    return false;
                }
                if ($('#js_a_select_op_type').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择OP类型");
                    return false;
                }
                if ($('#js_a_select_fun_plant').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择功能厂");
                    return false;
                }
                if ($('#js_a_customerId').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择专案");
                    return false;
                }
                if ($('#js_a_select_line_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择线别");
                    return false;
                }
                if ($('#js_a_select_station_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选着工站");
                    return false;
                }
                if ($('#js_a_select_machine_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择机台");
                    return false;
                }
                if ($('#js_a_select_meeting_type_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择会议类型");
                    return false;
                }
                if ($('#js_a_status_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择状态");
                    return false;
                }
                if ($('#js_a_improvementplanId_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请输入部门");
                    return false;
                }
                if ($('#js_a_improvementplan_name_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请输入Action Name");
                    return false;
                }

                if ($('#js_a_status_id').val() != 1) {
                    if ($('#js_a_input_DirDueDate').val() == '') {
                        PDMS.Utility.MessageBox.info("请输入Dir Due Date");
                        return false;
                    }
                }

                var params = {};
                params["ImprovementPlan_UID"] = $('#hidImprovementPlan_UID').val(); //0
                params["Plant_Organization_UID"] = $('#js_a_select_factory').val(); //1
                params["BG_Organization_UID"] = $('#js_a_select_op_type').val();//2
                params["FunPlant_Organization_UID"] = $('#js_a_select_fun_plant').val();//3
                params["Project_UID"] = $('#js_a_customerId').val();//4
                params["LineID"] = $('#js_a_select_line_id').val();//5
                params["StationID"] = $('#js_a_select_station_id').val();//6
                params["OEE_MachineInfo_UID"] = $('#js_a_select_machine_id').val();//7
                params["MeetingType_UID"] = $('#js_a_select_meeting_type_id').val();//8
                params["ImprovementPlan_ID"] = $('#js_a_improvementplanId_id').val();//9
                params["Status"] = $('#js_a_status_id').val();//10
                params["ImprovementPlan_Name"] = $('#js_a_improvementplan_name_id').val();//11
                params["Audience"] = $('#js_a_input_audience').val();//12
                params["Responsible"] = $('#js_a_input_responsible').val();//13
                params["Problem_Description"] = $('#js_a_input_problemdescription_id').val();//14
                params["Created_Date"] = $('#js_a_commit_date_date').val();//15
                params["Root_Cause"] = $('#js_a_root_cause').val();//16
                params["Due_Date"] = $('#js_a_input_due_date').val();//17
                params["Comment"] = $('#js_a_comment').val();//18
                params["Close_Date"] = $('#js_a_input_close_date').val();//19
                params["DirDueDate"] = $('#js_a_input_DirDueDate').val();//20
                params["CACP_Description"] = $('#js_a_cacp_description').val();//21
               
                var detailParams = [];
                METRICES_ONEDATA().each(function (dto) {
                    var detailParam = {};
                    detailParam["Metric_UID"] = dto.Metric_UID;
                    detailParam["Metric_ID"] = dto.Metric_ID;
                    detailParam["Metric_Name"] = dto.Metric_Name;
                    detailParam["ImprovementPlan_UID"] = $('#hidImprovementPlan_UID').val();
                    detailParams.push(detailParam);
                });

                if (detailParams.length == 0) {
                    PDMS.Utility.MessageBox.info("请增加Metric");
                    return false;
                }

                params["OEE_ImprovementPlanDetailList"] = detailParams;
                var url = '../OEE/UpdateImprovementPlan';
                $.post(url, params, function (data) {
                    var obj = jQuery.parseJSON(data);
                    if (obj.length > 0) {
                        if (obj == "SUCCESS") {
                            $('#js_add_modal').modal('hide');
                            PDMS.Utility.MessageBox.info("SUCCESS", function () {
                                //window.location.reload();
                            });
                        } else {
                            PDMS.Utility.MessageBox.error(obj);
                        }
                        Metrices.QueryPurchase();
                    }
                    else {
                        $('#js_add_modal').modal('hide');
                        $('#js_Config_Submit').modal('hide');
                        PDMS.Utility.MessageBox.info("保存成功");
                        $('#btn_search').trigger('click');
                    }
                });
            })

            ///新增
            $('#js_btn_add').click(function () {
                $('#js_add_modal').find(".modal-title").html('新增');
                $('#js_btn_save_new').show();
                $('#js_btn_save_edit').hide();
                $('#js_btn_cancel').show();
                $('#bt_add_mat').show();
                $('#bt_remove_mat').show();
                $('#hidImprovementPlan_UID').val(0);
                $('#div_closedate').hide();
                $('#div_createtime').hide();
                $('#div_dueDate').show();
                $('#div_driduedate').hide();
                $('#js_a_status_id').html('');
                $('#js_a_status_id').selectpicker('refresh');
                $('#js_a_status_id').append('<option value= 1 >' + '1 - Open开单' + '</option>');
                $('#js_a_status_id').selectpicker('refresh');
                $('#js_a_input_due_date').attr("disabled", false);
                SetNoReadonly();
            });

            ///删除Metrice
            $('#bt_remove_mat').on('click', function () {
                var checkedItems = $('#js_metrice_datatable_detail .js-checkbox-item:checked');
                if (checkedItems.length == 0) {
                    PDMS.Utility.MessageBox.info("请选择需要删除的行。");
                    return false;
                }
                else {
                    checkedItems.each(function (index, checkbox) {
                        var tr = checkbox.closest('tr');
                        var td = $(tr).find("td")[1];
                        var index = parseInt(td.textContent);
                        METRICES_ONEDATA({ index: index }).remove();
                    });

                    //重新排列序号
                    METRICES_ONEDATA().each(function (dto, i) {
                        var index = i + 1;
                        //更新二级表索引
                        METRICES_ONEDATA({ index: dto.index }).update({ index: index });
                    });

                    var params = [];
                    METRICES_ONEDATA().each(function (dto) {
                        var paramItem = dto;
                        params.push(paramItem);
                    });

                    //重新绑定明细表不能用Table.row(tr).remove().draw()这种方法，index不会重新绑定
                    subTable = $('#js_metrice_datatable_detail').DataTable({
                        columns: GetDetailColumn(),
                        ordering: false,
                        data: params,
                    });
                }
            });

            function SetReadonly() {
                $('#js_a_select_factory').attr("readOnly", "true");
                $('#js_a_select_factory').attr("readOnly", "true");
                $('#js_a_select_op_type').attr("readOnly", "true");
                $('#js_a_select_fun_plant').attr("readOnly", "true");
                $('#js_a_customerId').attr("readOnly", "true");
                $('#js_a_select_line_id').attr("readOnly", "true");
                $('#js_a_select_station_id').attr("readOnly", "true");
                $('#js_a_select_meeting_type_id').attr("readOnly", "true");
                $('#js_a_status_id').attr("readOnly", "true");
                $('#js_a_improvementplanId_id').attr("readOnly", "true");
                $('#js_a_improvementplan_name_id').attr("readOnly", "true");
                $('#js_a_input_audience').attr("readOnly", "true");
                $('#js_a_input_responsible').attr("readOnly", "true");
                $('#js_a_input_problemdescription_id').attr("readOnly", "true");
                $('#js_a_commit_date_date').attr("readOnly", "true");
                $('#js_a_root_cause').attr("readOnly", "true");
                $('#js_a_input_due_date').attr("readOnly", "true");
                $('#js_a_comment').attr("readOnly", "true");
                $('#js_a_input_close_date').attr("readOnly", "true");
            }

            function SetNoReadonly() {
                $('#js_a_select_factory').removeAttr("readOnly");
                $('#js_a_select_op_type').removeAttr("readOnly");
                $('#js_a_select_fun_plant').removeAttr("readOnly");
                $('#js_a_customerId').removeAttr("readOnly");
                $('#js_a_select_line_id').removeAttr("readOnly");
                $('#js_a_select_station_id').removeAttr("readOnly");
                $('#js_a_select_meeting_type_id').removeAttr("readOnly");
                $('#js_a_status_id').removeAttr("readOnly");
                $('#js_a_improvementplanId_id').removeAttr("readOnly");
                $('#js_a_improvementplan_name_id').removeAttr("readOnly");
                $('#js_a_input_audience').removeAttr("readOnly");
                $('#js_a_input_responsible').removeAttr("readOnly");
                $('#js_a_input_problemdescription_id').removeAttr("readOnly");
                $('#js_a_commit_date_date').removeAttr("readOnly");
                $('#js_a_root_cause').removeAttr("readOnly");
                $('#js_a_input_due_date').removeAttr("readOnly");
                $('#js_a_comment').removeAttr("readOnly");
                $('#js_a_input_close_date').removeAttr("readOnly");
            }

            ///保存 js_btn_save_new
            $('#js_btn_save_new').click(function () {
                if ($('#js_a_select_factory').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择厂区");
                    return false;
                }
                if ($('#js_a_select_op_type').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择OP类型");
                    return false;
                }
                if ($('#js_a_select_fun_plant').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择功能厂");
                    return false;
                }
                if ($('#js_a_customerId').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择专案");
                    return false;
                }
                if ($('#js_a_select_line_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择线别");
                    return false;
                }
                if ($('#js_a_select_station_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选着工站");
                    return false;
                }
                if ($('#js_a_select_machine_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择机台");
                    return false;
                }
                if ($('#js_a_select_meeting_type_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择会议类型");
                    return false;
                }
                if ($('#js_a_status_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请选择状态");
                    return false;
                }
                if ($('#js_a_improvementplanId_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请输入Action ID");
                    return false;
                }
                if ($('#js_a_improvementplan_name_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请输入Action Name");
                    return false;
                }
                if ($('#js_a_input_problemdescription_id').val() == '') {
                    PDMS.Utility.MessageBox.info("请输入问题描述");
                    return false;
                }

                if (($('#js_a_input_due_date').val() == '')) {
                    PDMS.Utility.MessageBox.info("请选择期望截止时间");
                    return false;
                }

                if (($('#js_a_input_due_date').val() == '')) {
                    PDMS.Utility.MessageBox.info("请选择期望截止时间");
                    return false;
                }

                var params = {};
                params["ImprovementPlan_UID"] = $('#hidImprovementPlan_UID').val(); //0
                params["Plant_Organization_UID"] = $('#js_a_select_factory').val(); //1
                params["BG_Organization_UID"] = $('#js_a_select_op_type').val();//2
                params["FunPlant_Organization_UID"] = $('#js_a_select_fun_plant').val();//3
                params["Project_UID"] = $('#js_a_customerId').val();//4
                params["LineID"] = $('#js_a_select_line_id').val();//5
                params["StationID"] = $('#js_a_select_station_id').val();//6
                params["OEE_MachineInfo_UID"] = $('#js_a_select_machine_id').val();//7
                params["MeetingType_UID"] = $('#js_a_select_meeting_type_id').val();//8
                params["ImprovementPlan_ID"] = $('#js_a_improvementplanId_id').val();//9
                params["Status"] = $('#js_a_status_id').val();//10
                params["ImprovementPlan_Name"] = $('#js_a_improvementplan_name_id').val();//11
                params["Audience"] = $('#js_a_input_audience').val();//12
                params["Responsible"] = $('#js_a_input_responsible').val();//13
                params["Problem_Description"] = $('#js_a_input_problemdescription_id').val();//14
                params["Commit_Date"] = $('#js_a_commit_date_date').val();//15
                params["Root_Cause"] = $('#js_a_root_cause').val();//16
                params["Due_Date"] = $('#js_a_input_due_date').val();//17
                params["Comment"] = $('#js_a_comment').val();//18
                params["Close_Date"] = $('#js_a_input_close_date').val();//19
                params["CACP_Description"] = $('#js_a_cacp_description').val();//19
                //params["CACP_Description"] = $('#js_a_cacp_description').val();//19

                var detailParams = [];
                METRICES_ONEDATA().each(function (dto) {
                    var detailParam = {};
                    detailParam["Metric_UID"] = dto.Metric_UID;
                    detailParam["Metric_ID"] = dto.Metric_ID;
                    detailParam["Metric_Name"] = dto.Metric_Name;
                    detailParam["ImprovementPlan_UID"] = $('#hidImprovementPlan_UID').val();
                    detailParams.push(detailParam);
                });

                if (detailParams.length == 0) {
                    PDMS.Utility.MessageBox.info("请增加Metric");
                    return false;
                }

                params["OEE_ImprovementPlanDetailList"] = detailParams;
                var url = '../OEE/SaveImprovementPlan';
                $.post(url, params, function (data) {
                    var obj = jQuery.parseJSON(data);
                    if (obj.length > 0) {
                        if (obj == "SUCCESS") {
                            $('#js_add_modal').modal('hide');
                            PDMS.Utility.MessageBox.info("SUCCESS", function () {
                                window.location.reload();
                            });
                        } else {
                            PDMS.Utility.MessageBox.error(obj);
                        }
                    }
                    else {
                        $('#js_add_modal').modal('hide');
                        $('#js_Config_Submit').modal('hide');
                        PDMS.Utility.MessageBox.info("保存成功");
                        $('#btn_search').trigger('click');
                    }
                });
            })
            $('body').on("click", ".js-grid-view", function () {
                $('#js_add_modal').find(".modal-title").html('查看');
                var uid = $(this).attr('data-nid');
                $('#js_a_status_id').html('<option></option>');
                $('#js_a_status_id').selectpicker('refresh');
                $('#js_a_status_id').append('<option value="' + 1 + '">' + '1 - Open开单' + '</option>');
                $('#js_a_status_id').append('<option value="' + 2 + '">' + '2 - WIP正在进行' + '</option>');
                $('#js_a_status_id').append('<option value="' + 3 + '">' + '3 - Delay延迟' + '</option>');
                $('#js_a_status_id').append('<option value="' + 4 + '">' + '4 - Close结案' + '</option>');
                $('#js_a_status_id').selectpicker('refresh');
                GetCommonSet(uid);
                //SetControlReadonly();
                SetReadonly();
                $('#bt_add_mat').hide();
                $('#bt_remove_mat').hide();
                $('#js_btn_save_new').hide();
                $('#js_btn_save_edit').hide();
                $('#js_btn_cancel').hide();
                $('#div_driduedate').show();
                $('#div_createtime').show();
                $('#js_a_commit_date_date').attr("disabled", "disabled");
                $('#js_a_input_due_date').attr("disabled", "disabled");
                $('#js_add_modal').modal('show');
            });
            $('body').on("click", ".js-grid-edit", function () {
                $('#js_add_modal').find(".modal-title").html('编辑');
                $('#js_a_status_id').html('<option></option>');
                $('#js_a_status_id').selectpicker('refresh');
                $('#js_a_status_id').append('<option value="' + 1 + '">' + '1 - Open开单' + '</option>');
                $('#js_a_status_id').append('<option value="' + 2 + '">' + '2 - WIP正在进行' + '</option>');
                $('#js_a_status_id').append('<option value="' + 3 + '">' + '3 - Delay延迟' + '</option>');
                $('#js_a_status_id').append('<option value="' + 4 + '">' + '4 - Close结案' + '</option>');
                $('#js_a_status_id').selectpicker('refresh');

                var uid = $(this).attr('data-nid');

                GetCommonSet(uid);
                SetNoReadonly();
                $('#bt_add_mat').show();
                $('#bt_remove_mat').show();
                $('#js_btn_save_new').hide();
                $('#js_btn_save_edit').show();
                $('#js_btn_cancel').show();
                $('#div_driduedate').show();
                $('#div_createtime').show();
                $('#js_a_commit_date_date').attr("disabled", "disabled");
                $('#js_a_input_due_date').attr("disabled", "disabled");

                if ($('#js_a_input_DirDueDate').val() != '' && $('#js_a_input_DirDueDate').val() != null) {
                    $('#js_a_input_DirDueDate').attr("disabled", "disabled");
                } else {
                    $('#js_a_input_DirDueDate').attr("disabled", false);
                }

                $('#js_add_modal').modal('show');
            });
            $('body').on("click", ".js-grid-Delete", function () {
                $('#js_add_modal').find(".modal-title").html('删除');
                var uid = $(this).attr('data-nid');
                var getByUIDUrl = '../OEE/DeleteImpeovementPlanById';
                $.post(getByUIDUrl, { improvementId: uid }, function (data) {
                    if (data == "SUCCESS") {
                        $('#js_add_modal').modal('hide');
                        PDMS.Utility.MessageBox.info("SUCCESS", function () {
                            window.location.reload();
                        });
                    } else {
                        PDMS.Utility.MessageBox.error(data);
                    }
                });
            });
            var getByUIDUrl = '../OEE/GetImprovementPlanById';
            var GetCommonSet = function (uid) {
                METRICES_ONEDATA = TAFFY();
                $.post(getByUIDUrl, { improvementId: uid }, function (data) {
                    $('#hidImprovementPlan_UID').val(uid);
                    //var obj = jQuery.parseJSON(data);
                    Date.prototype.Format = function (fmt) { //author: meizz
                        var o = {
                            "M+": this.getMonth() + 1, //月份
                            "d+": this.getDate(), //日
                            "h+": this.getHours(), //小时
                            "m+": this.getMinutes(), //分
                            "s+": this.getSeconds(), //秒
                            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                            "S": this.getMilliseconds() //毫秒
                        };
                        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                        for (var k in o)
                            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                        return fmt;
                    }
                    var obj = data;
                    //下拉框选择厂区
                    refreplant();
                    $('#js_a_select_factory').selectpicker('val', obj.Plant_Organization_UID);
                    $('#js_a_select_factory').selectpicker('refresh');
                    //下拉框选择OP
                    refrefactory(obj.Plant_Organization_UID);
                    refreOpType($('#js_a_select_op_type').val(), $('#js_a_select_op_type option:selected').text());
                    $('#js_a_select_op_type').selectpicker('val', obj.BG_Organization_UID);
                    $('#js_a_select_op_type').selectpicker('refresh');
                    //下拉框选择功能厂
                    refreshSearchFuncPlantSelect($('#js_a_select_op_type').val());

                    $('#js_a_select_fun_plant').selectpicker('refresh');
                    $('#js_a_select_fun_plant').selectpicker('val', obj.FunPlant_Organization_UID);

                    //专案
                    refreshSearchProjectSelect($('#js_a_select_op_type').val());
                    $('#js_a_customerId').selectpicker('refresh');
                    $('#js_a_customerId').selectpicker('val', obj.Project_UID);

                    //线别
                    refreLine($('#js_a_customerId option:selected').val());
                    $('#js_a_select_line_id').selectpicker('refresh');
                    $('#js_a_select_line_id').selectpicker('val', obj.LineID);

                    //工站
                    refreStation($('#js_a_select_line_id option:selected').val());
                    $('#js_a_select_station_id').selectpicker('refresh');
                    $('#js_a_select_station_id').selectpicker('val', obj.StationID);

                    //机台
                    refreMachine($('#js_a_select_station_id option:selected').val());
                    $('#js_a_select_machine_id').selectpicker('refresh');
                    $('#js_a_select_machine_id').selectpicker('val', obj.OEE_MachineInfo_UID);

                    //状态
                    $('#js_a_status_id').selectpicker('refresh');
                    $('#js_a_status_id').selectpicker('val', obj.Status);

                    $('#js_a_select_meeting_type_id').val(obj.MeetingType_UID);
                    $('#js_a_improvementplanId_id').val(obj.ImprovementPlan_ID);
                    $('#js_a_improvementplan_name_id').val(obj.ImprovementPlan_Name);
                    $('#js_a_input_audience').val(obj.Audience);
                    $('#js_a_input_responsible').val(obj.Responsible);
                    $('#js_a_input_problemdescription_id').val(obj.Problem_Description);

                    if (obj.Created_Date == '' || new Date(obj.Created_Date).Format("yyyy-MM-dd") == "1900-01-01") {
                        $('#js_a_commit_date_date').val('');
                    } else {
                        $('#js_a_commit_date_date').val(new Date(obj.Created_Date).Format("yyyy-MM-dd hh:mm"));
                    }
                    $('#js_a_root_cause').val(obj.Root_Cause);

                    if (obj.Due_Date == '' || new Date(obj.Due_Date).Format("yyyy-MM-dd") == "1900-01-01") {
                        $('#js_a_input_due_date').val('');
                    } else {
                        $('#js_a_input_due_date').val(new Date(obj.Due_Date).Format("yyyy-MM-dd hh:mm"));
                    }

                    $('#js_a_cacp_description').val(obj.CACP_Description);
                    $('#js_a_comment').val(obj.Comment);

                    if (obj.Close_Date == '' || new Date(obj.Close_Date).Format("yyyy-MM-dd") == "1900-01-01") {
                        $('#js_a_input_close_date').val('');
                    } else {
                        $('#js_a_input_close_date').val(new Date(obj.Close_Date).Format("yyyy-MM-dd hh:mm"));
                    }

                    if (obj.DirDueDate=='' || new Date(obj.DirDueDate).Format("yyyy-MM-dd") == "1900-01-01") {
                        $('#js_a_input_DirDueDate').val('');
                    } else {
                        $('#js_a_input_DirDueDate').val(new Date(obj.DirDueDate).Format("yyyy-MM-dd hh:mm"));
                    }

                    $.each(obj.OEE_ImprovementPlanDetailList, function (i, dto) {
                        var index = i + 1;
                        //将数据插入插件中
                        METRICES_ONEDATA.insert({
                            index: index,
                            ImprovementPlan_UID: dto.ImprovementPlan_UID,
                            Metric_ID: dto.Metric_ID,
                            Metric_UID: dto.Metric_UID,
                            Metric_Name: dto.Metric_Name,
                        });
                    });

                    subTable = $('#js_metrice_datatable_detail').DataTable({
                        columns: GetDetailColumn(),
                        ordering: false,
                        data: obj.OEE_ImprovementPlanDetailList,
                        destroy: true
                    });
                });
            }
        });
    </script>
}


