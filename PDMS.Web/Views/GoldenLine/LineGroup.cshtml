@model PDMS.Model.ViewModels.Fixture_PartVM
@{
    ViewBag.Delete = T("Common.Delete").Text;
    ViewBag.Edit = T("Common.Edit").Text;
}
<section class="content portal-content">
    <div class="row col-lg-12">
        <form id="js_form_query" class="form-inline" data-need-validate="true">
            <div class="form-group">
                <label class="titlewhite">@T("GL.Site"):</label>
                <select class="selectpicker form-control input-sm" id="js_m_select_factory" name="Plant_Organization_UID" data-live-search="true"></select>
            </div>
            <div class="form-group">
                <label class="titlewhite">@T("GL.BG"):</label>
                <select class="selectpicker form-control input-sm" id="js_m_select_op_type" name="BG_Organization_UID" data-live-search="true"></select>
            </div>
            <div class="form-group" style="display:none;">
                <label class="titlewhite">@T("GL.FunctionPlant"):</label>
                <select class="selectpicker form-control input-sm" id="js_m_select_fun_plant" name="FunPlant_Organization_UID" data-live-search="true"></select>
            </div>
            <div class='form-group'>
                <label class="titlewhite">@T("GL.Project")</label>
                <select class="selectpicker form-control input-sm" id="js_m_customerId" name="CustomerID" data-live-search="true"> </select>
            </div>
            <div class="form-group">
                <label class="titlewhite">主线:</label>
                <select class="selectpicker form-control input-sm" id="js_m_select_group_line" name="LineID" data-live-search="true"></select>
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-primary btn-sm" id="js_btn_query">@T("Common.Search")</button>
                <button type="button" class="btn btn-primary btn-sm" role="button" data-toggle="modal" data-target="#js_edit_modal" id="js_btn_add_groupline">新增主線</button>
                <button type="button" class="btn btn-primary btn-sm" role="button" data-toggle="modal" data-target="#js_edit_s_modal" id="js_btn_add_subline">新增子產線</button>
            </div>
        </form>

    </div>
    <hr class="hr-custom">
    <div class="row">
        <div class="col-md-12 table-container">
            <table class="table table-striped table-hover table-condensed nowrap" id="js_line_datatable">
                <thead>
                    <tr>
                        <th class="table-col-seq nosort">@T("Common.Seq")</th>
                        <th class="table-col-action nosort">@T("Common.Action")</th>
                        <th>@T("GL.Site")</th>
                        <th>@T("GL.BG")</th>
                        @*<th>@T("GL.FunctionPlant")</th>*@
                        <th>@T("GL.Project")</th>
                        <th>主線</th>
                        <th>產線</th>
                        <th>@T("QA.Editor")</th>
                        <th>@T("QA.Changetime")</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th class="table-col-seq nosort">@T("Common.Seq")</th>
                        <th class="table-col-action nosort">@T("Common.Action")</th>
                        <th>@T("GL.Site")</th>
                        <th>@T("GL.BG")</th>
                        @*<th>@T("GL.FunctionPlant")</th>*@
                        <th>@T("GL.Project")</th>
                        <th>主線</th>
                        <th>產線</th>
                        <th>@T("QA.Editor")</th>
                        <th>@T("QA.Changetime")</th>
                    </tr>
                </tfoot>
            </table>
            <div id="page" class="row"></div>
        </div>
    </div>
</section>

@section ViewModals{
    <!-- Add/Edit Modal LineGroup -->
    <div class="modal fade" id="js_edit_modal" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Add New Line Group</h4>
                </div>
                <div class="modal-body">
                    <form id="js_form_maintain" class="form-horizontal clearfix">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_select_factory">廠區</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_select_factory" name="Plant_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_select_op_type">OP類型</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_select_op_type" name="BG_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" style="display:none;">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_select_fun_plant">功能廠</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_select_fun_plant" name="FunPlant_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class='form-group'>
                                    <label class="col-sm-6 control-label">@T("GL.Project")</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_customerId" name="CustomerID" data-live-search="true"> </select>
                                    </div>
                                </div>
                            </div>
                            <input class="form-group" type="hidden" name="LineGroup_UID" id="js_hidden_line_group_uid" value="0" />
                            <!--jquery validata error container-->
                            <div class="col-xs-12"><ul class="list-group validate-error"></ul></div>
                        </div>
                        <hr class="no-margin" />
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_input_group_line_name">產線名稱</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control input-sm" name="LineName" id="js_input_group_line_name">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</button>
                    <button type="button" class="btn btn-primary btn-sm" id="js_btn_save_new"><i class="fa fa-save"></i> Save</button>
                    <button type="button" class="btn btn-primary btn-sm" id="js_btn_save_edit"><i class="fa fa-save"></i> Edit Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal subLineGroup子產線 -->
    <div class="modal fade" id="js_edit_s_modal" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Add New Sub Line Group</h4>
                </div>
                <div class="modal-body">
                    <form id="js_form_s_maintain" class="form-horizontal clearfix">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_s_input_factory">廠區</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_factory" name="Plant_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_s_input_op_type">OP類型</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_op_type" name="BG_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6" style="display:none;">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_s_input_fun_plant">功能廠</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_s_select_fun_plant" name="FunPlant_Organization_UID" data-live-search="true"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class='form-group'>
                                    <label class="col-sm-6 control-label">@T("GL.Project")</label>
                                    <div class="col-sm-6">
                                        <select class="selectpicker form-control input-sm" id="js_s_customerId" name="CustomerID" data-live-search="true"> </select>
                                    </div>
                                </div>
                             </div>

                                <input type="hidden" name="LineGroup_UID" id="js_s_hidden_line_group_uid" value="0" />
                                <input class="form-group" type="hidden" name="LineName" id="js_s_hidden_line_name" value="" />
                                <!--jquery validata error container-->
                                <div class="col-xs-12"><ul class="list-group validate-error"></ul></div>
                            </div>
                            <hr class="no-margin" />
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label" for="js_s_input_group_line">主線</label>
                                        <div class="col-sm-6">
                                            <select class="selectpicker form-control input-sm" id="js_s_select_group_line" name="LineParent_ID" data-live-search="true"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="col-sm-6 control-label" for="js_s_input_group_line">產線</label>
                                        <div class="col-sm-6">
                                            <select class="selectpicker form-control input-sm" id="js_s_select_sub_line" name="LineID" data-live-search="true"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
</form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</button>
                    <button type="button" class="btn btn-primary btn-sm" id="js_s_btn_save_new"><i class="fa fa-save"></i> Save</button>
                    <button type="button" class="btn btn-primary btn-sm" id="js_s_btn_save_edit"><i class="fa fa-save"></i> Edit Save</button>
                </div>
            </div>
        </div>
    </div>
}


@section ViewScripts{
    <link rel="stylesheet" type="text/css" href="~/Content/css/bootstrap-select.css" />
    <script type="text/javascript" src="~/Scripts/EQP/bootstrap-select.js"></script>
    <script type="text/javascript">
        $(function () {
            var LineGroupUrls = {
                queryGroupLines: '@Url.Action("QueryGroupLines", "GoldenLine")',
                queryGroupLine: '@Url.Action("QueryGroupLine", "GoldenLine")',
                addGroupLine: '@Url.Action("AddGroupLine", "GoldenLine")',
                addSubToGroup: '@Url.Action("AddSubToGroup", "GoldenLine")',
                removeGroupLine: '@Url.Action("RemoveGroupLine", "GoldenLine")',
                modifyGroupLine: '@Url.Action("ModifyGroupLine", "GoldenLine")',
                getPlants: '@Url.Action("GetPlantsUseSettingsAPI", "GoldenLine")',
                getOPType: '@Url.Action("GetOPTypeUseFixtureAPI", "GoldenLine")',
                getFunPlant: '@Url.Action("GetFunPlantUseFixtureAPI", "GoldenLine")',
                getGroupLine: '@Url.Action("GetGroupLine", "GoldenLine")',
                getSubLine: '@Url.Action("GetSubLine", "GoldenLine")',
                getCustomerId: '@Url.Action("GetCustomerId", "GoldenLine")',
                getCustomerDTOs: '@Url.Action("GetCustomerDTOs", "GoldenLine")',
            };

            //#region LineGroup
            var LineGroup = (function () {

                //#region columns
                var columns = [
                    {
                        data: null,
                        className: "table-col-seq"
                    }, {
                        createdCell: function (td, cellData, rowData, row, col) {
                            $(td).html('<button class="btn btn-primary btn-xs" rel="action-popover">' +
                                '<i class="fa fa-reorder"></i>' +
                                '</button>' +
                                '<div class="hidden popover-content">' +
                                '<button type="button" class="btn btn-primary btn-xs js-grid-view" data-id="' + rowData.LineGroup_UID + '" >View</button>' +
                                '<button type="button" class="btn btn-primary btn-xs js-grid-edit" data-id="' + rowData.LineGroup_UID + '" >Edit</button>' +
                                '<button type="button" class="btn btn-primary btn-xs js-grid-delete" data-id="' + rowData.LineGroup_UID + '" >Delete</button>' +
                                '</div>');
                        },
                        className: "text-center min-col-xs"
                    }, {
                        data: "factory",
                        className: "min-col-xs"
                    }, {
                        data: "op_Type",
                        className: "min-col-xs"
                    }, {
                        data: "Project_Name",
                        className: "min-col-xs"
                    }, {
                        data: "LineParent_Name",
                        className: "min-col-lg"
                    }, {
                        data: "LineName",
                        className: "min-col-lg"
                    }, {
                        data: "Modified_UserName",
                        className: "min-col-lg"
                    }, {
                        data: "Modified_Date",
                        className: "min-col-lg"
                    }];
                //#endregion


                var _getParams = function () {
                    return $('#js_form_query').serialize().replace(/\+/g, " ");
                };

                var _queryLineGroups = function (firstLoad) {

                    var config = {
                        pageId: "#page",
                        tableId: "#js_line_datatable",
                        remoteUrl: LineGroupUrls.queryGroupLines,
                        searchParams: _getParams(),
                        tableOptions: {
                            scrollX: true,
                            scrollCollapse: false,
                            autoWidth: true,
                            columns: columns
                        }
                    };

                    if (!firstLoad) {
                        $('#page').page('destroy');
                        PDMS.Utility.Criteria.Build();
                    }

                    PDMS.Utility.Pages.Set(config);
                };

                return {
                    Init: function () {

                        PDMS.Utility.Criteria.Init();
                        _queryLineGroups(true);
                        console.log('_queryLineGroups(true);');
                    },
                    QueryGroupLines: function () {
                        _queryLineGroups(false);
                        console.log('_queryLineGroups(false)');
                    }
                }

            })();
            //#endregion
            LineGroup.Init();
            console.log('LineGroup.Init()');
            //廠區資料載入
            url = LineGroupUrls.getPlants;
            $.post(url, function (data) {
                $('#js_m_select_factory').html('<option></option>');
                $('#js_s_select_factory').html('<option></option>');
                $('#js_select_factory').html('<option></option>');
                for (var i = 0; i < data.length; i++) {
                    //主頁
                    if ($('#js_m_select_factory').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                        $('#js_m_select_factory').append('<option value="' + data[i].Organization_UID + '">' + data[i].Organization_Name + '</option>');
                    }
                    //子線頁
                    if ($('#js_s_select_factory').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                        $('#js_s_select_factory').append('<option value="' + data[i].Organization_UID + '">' + data[i].Organization_Name + '</option>');
                    }
                    //主線頁
                    if ($('#js_select_factory').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                        $('#js_select_factory').append('<option value="' + data[i].Organization_UID + '">' + data[i].Organization_Name + '</option>');
                    }
                }
                $('#js_m_select_factory').selectpicker('val', '');
                $('#js_s_select_factory').selectpicker('val', '');
                $('#js_select_factory').selectpicker('val', '');
            });

            //主頁廠區變更
            $('#js_m_select_factory').change(function () {
                var oporgid = $('#js_m_select_factory option:selected').val();
                url = LineGroupUrls.getOPType;
                $('#js_m_select_op_type').html('<option></option>');
                $('#js_m_select_op_type').selectpicker('refresh');

                $('#js_m_select_fun_plant').html('<option></option>');
                $('#js_m_select_fun_plant').selectpicker('refresh');

                $('#js_m_customerId').html('<option></option>');
                $('#js_m_customerId').selectpicker('refresh');
                if (oporgid != 0) {
                    $.post(url, { plant_OrganizationUID: oporgid }, function (data) {

                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_m_select_op_type').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                                $('#js_m_select_op_type').append('<option value="' + data[i].Organization_UID + '">' + data[i].OP_TYPES + '</option>');
                            }
                        }
                        $('#js_m_select_op_type').selectpicker('refresh');
                    });
                }
            })

            //主頁op類型變更
            $('#js_m_select_op_type').change(function () {
                $('#js_m_select_fun_plant').html('<option></option>');
                $('#js_m_customerId').html('<option></option>');
                if ($('#js_m_select_op_type').val() != "") {
                    var url = LineGroupUrls.getFunPlant;
                    var get_customer_id_url = LineGroupUrls.getCustomerDTOs;
                    $.post(url, { oporgid: $('#js_m_select_op_type').val(), optypes: $('#js_m_select_op_type option:selected').text() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_m_select_fun_plant').find('option[value=' + data[i].System_FunPlant_UID + ']').length == 0) {
                                $('#js_m_select_fun_plant').append('<option value="' + data[i].System_FunPlant_UID + '">' + data[i].FunPlant + '</option>');
                            }
                        }
                        $('#js_m_select_fun_plant').selectpicker('refresh');
                    });
                    $.get(get_customer_id_url, { BG_Organization_UID: $('#js_m_select_op_type').val() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_m_customerId').find('option[value=' + data[i].Project_UID + ']').length == 0) {
                                $('#js_m_customerId').append('<option value="' + data[i].Project_UID + '">' + data[i].Project_Name + '</option>');
                            }
                        }
                        $('#js_m_customerId').selectpicker('refresh');
                    });

                }
            })

            //主頁專案變更
            $('#js_m_customerId').change(function () {
                var get_group_line_url = LineGroupUrls.getGroupLine;
                $.post(get_group_line_url, { oporgid: $('#js_m_select_factory').val(), optypes: $('#js_m_select_op_type').val(), opFunPlant: $('#js_m_select_fun_plant').val() }, function (data) {
                    $('#js_m_select_group_line').html('<option></option>');
                    for (var i = 0; i < data.length; i++) {
                        //主頁
                        if ($('#js_m_select_group_line').find('option[value=' + data[i].LineGroup_UID + ']').length == 0) {
                            $('#js_m_select_group_line').append('<option value="' + data[i].LineGroup_UID + '">' + data[i].LineName + '</option>');
                        }
                    }
                    $('#js_m_select_group_line').selectpicker('refresh');
                });
            })
            //主頁功能廠變更
            $('#js_m_select_fun_plant').change(function () {
                $('#js_m_select_group_line').html('<option></option>');
                $('#js_m_select_group_line').selectpicker('refresh');
                if ($('#js_m_select_fun_plant').val() != "") {
                    var get_group_line_url = LineGroupUrls.getGroupLine;
                    $.post(get_group_line_url, { oporgid: $('#js_m_select_factory').val(), optypes: $('#js_m_select_op_type').val(), opFunPlant: $('#js_m_select_fun_plant').val() }, function (data) {
                        $('#js_m_select_group_line').html('<option></option>');
                        for (var i = 0; i < data.length; i++) {
                            //主頁
                            if ($('#js_m_select_group_line').find('option[value=' + data[i].LineGroup_UID + ']').length == 0) {
                                $('#js_m_select_group_line').append('<option value="' + data[i].LineGroup_UID + '">' + data[i].LineName + '</option>');
                            }
                        }
                        $('#js_m_select_group_line').selectpicker('refresh');
                    });
                }
            })

            //主線頁廠區變更
            $('#js_select_factory').change(function () {
                var oporgid = $('#js_select_factory option:selected').val();
                url = LineGroupUrls.getOPType;
                $('#js_select_op_type').html('<option></option>');
                $('#js_select_op_type').selectpicker('refresh');

                $('#js_select_fun_plant').html('<option></option>');
                $('#js_select_fun_plant').selectpicker('refresh');
                if (oporgid != 0) {
                    $.post(url, { plant_OrganizationUID: oporgid }, function (data) {

                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_select_op_type').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                                $('#js_select_op_type').append('<option value="' + data[i].Organization_UID + '">' + data[i].OP_TYPES + '</option>');
                            }
                        }
                        $('#js_select_op_type').selectpicker('refresh');
                    });
                }
            })

            //主線頁op類型變更
            $('#js_select_op_type').change(function () {
                $('#js_select_fun_plant').html('');
                $('#js_customerId').html('');
                if ($('#js_select_op_type').val() != "") {
                    var url = LineGroupUrls.getFunPlant;
                    var get_customer_id_url = LineGroupUrls.getCustomerDTOs;
                    $.post(url, { oporgid: $('#js_select_op_type').val(), optypes: $('#js_select_op_type option:selected').text() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            debugger;
                            if ($('#js_select_fun_plant').find('option[value=' + data[i].System_FunPlant_UID + ']').length == 0) {
                                $('#js_select_fun_plant').append('<option value="' + data[i].System_FunPlant_UID + '">' + data[i].FunPlant + '</option>');
                            }
                        }
                        $('#js_select_fun_plant').selectpicker('refresh');
                    })
                    $.get(get_customer_id_url, { BG_Organization_UID: $('#js_select_op_type').val() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_customerId').find('option[value=' + data[i].Project_UID + ']').length == 0) {
                                $('#js_customerId').append('<option value="' + data[i].Project_UID + '">' + data[i].Project_Name + '</option>');
                            }
                        }
                        $('#js_customerId').selectpicker('refresh');
                    });

                }
            })

            //子線頁廠區變更
            $('#js_s_select_factory').change(function () {
                var oporgid = $('#js_s_select_factory option:selected').val();
                url = LineGroupUrls.getOPType;
                var get_group_line_url = LineGroupUrls.getGroupLine;
                $('#js_s_select_op_type').html('<option></option>');
                $('#js_s_select_op_type').selectpicker('refresh');

                $('#js_s_select_fun_plant').html('<option></option>');
                $('#js_s_select_fun_plant').selectpicker('refresh');

                $('#js_s_select_group_line').html('<option></option>');
                $('#js_s_select_group_line').selectpicker('refresh');

                $('#js_s_select_sub_line').html('<option></option>');
                $('#js_s_select_sub_line').selectpicker('refresh');
                if (oporgid != 0) {
                    $.post(url, { plant_OrganizationUID: oporgid }, function (data) {

                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_s_select_op_type').find('option[value=' + data[i].Organization_UID + ']').length == 0) {
                                $('#js_s_select_op_type').append('<option value="' + data[i].Organization_UID + '">' + data[i].OP_TYPES + '</option>');
                            }
                        }
                        $('#js_s_select_op_type').selectpicker('refresh');
                    });
                    $.post(get_group_line_url, { oporgid: $('#js_s_select_factory').val(), optypes: $('#js_s_select_op_type').val(), opFunPlant: $('#js_s_select_fun_plant').val() }, function (data) {
                        console.log("子線頁廠區變更"+data);
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_s_select_group_line').find('option[value=' + data[i].LineGroup_UID + ']').length == 0) {
                                $('#js_s_select_group_line').append('<option value="' + data[i].LineGroup_UID + '">' + data[i].LineName + '</option>');
                            }
                        }
                        $('#js_s_select_group_line').selectpicker('refresh');
                    });
                }
            })

            //子線頁op類型變更
            $('#js_s_select_op_type').change(function () {
                $('#js_s_select_fun_plant').html('<option></option>');
                $('#js_s_select_fun_plant').selectpicker('refresh');
                $('#js_s_customerId').html('<option></option>');
                $('#js_s_customerId').selectpicker('refresh');
                $('#js_s_select_group_line').html('<option></option>');
                $('#js_s_select_group_line').selectpicker('refresh');
                if ($('#js_s_select_op_type').val() != "") {
                    var url = LineGroupUrls.getFunPlant;
                    var get_customer_id_url = LineGroupUrls.getCustomerDTOs;
                    $.post(url, { oporgid: $('#js_s_select_op_type').val(), optypes: $('#js_s_select_op_type option:selected').text() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_s_select_fun_plant').find('option[value=' + data[i].System_FunPlant_UID + ']').length == 0) {
                                $('#js_s_select_fun_plant').append('<option value="' + data[i].System_FunPlant_UID + '">' + data[i].FunPlant + '</option>');
                            }
                        }
                        $('#js_s_select_fun_plant').selectpicker('refresh');
                    });
                    $.get(get_customer_id_url, { BG_Organization_UID: $('#js_s_select_op_type').val() }, function (data) {
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_s_customerId').find('option[value=' + data[i].Project_UID + ']').length == 0) {
                                $('#js_s_customerId').append('<option value="' + data[i].Project_UID + '">' + data[i].Project_Name + '</option>');
                            }
                        }
                        $('#js_s_customerId').selectpicker('refresh');
                    });

                    //載入子線
                    var get_sub_line_url = LineGroupUrls.getSubLine;
                    $.post(get_sub_line_url, { oporgid: $('#js_s_select_factory').val(), optype: $('#js_s_select_op_type').val()}, function (data) {
                        $('#js_s_select_sub_line').html('<option></option>');
                        for (var i = 0; i < data.length; i++) {
                            if ($('#js_s_select_sub_line').find('option[value=' + data[i].Line_ID + ']').length == 0) {
                                $('#js_s_select_sub_line').append('<option value="' + data[i].Line_ID + '">' + data[i].LineName + '</option>');
                            }
                        }
                        $('#js_s_select_sub_line').selectpicker('refresh');
                    });
                }
            })

            //子線頁專案變更
            $('#js_s_customerId').change(function () {
                var get_group_line_url = LineGroupUrls.getGroupLine;
                $.post(get_group_line_url, { oporgid: $('#js_s_select_factory').val(), optypes: $('#js_s_select_op_type').val(), opFunPlant: $('#js_s_select_fun_plant').val(), customerId: $('#js_s_customerId').val()}, function (data) {
                    for (var i = 0; i < data.length; i++) {
                        if ($('#js_s_select_group_line').find('option[value=' + data[i].LineGroup_UID + ']').length == 0) {
                            $('#js_s_select_group_line').append('<option value="' + data[i].LineGroup_UID + '">' + data[i].LineName + '</option>');
                        }
                    }
                    $('#js_s_select_group_line').selectpicker('refresh');
                });
            })
            

            //主線資料載入
            var get_group_line_url = LineGroupUrls.getGroupLine;
            $.post(get_group_line_url, { oporgid: $('#js_m_select_op_type').val(), optypes: $('#js_m_select_op_type').val(), opFunPlant: $('#js_m_select_fun_plant').val(), customerId: $('#js_m_customerId').val() }, function (data) {
                $('#js_m_select_group_line').html('<option></option>');
                $('#js_s_select_group_line').html('<option></option>');
                console.log(data);
                for (var i = 0; i < data.length; i++) {
                    //主頁
                    if ($('#js_m_select_group_line').find('option[value=' + data[i].LineGroup_UID + ']').length == 0) {
                        $('#js_m_select_group_line').append('<option value="' + data[i].LineGroup_UID + '">' + data[i].LineName + '</option>');
                    }
                    //子線頁
                    if ($('#js_s_select_group_line').find('option[value=' + data[i].LineGroup_UID + ']').length == 0) {
                        $('#js_s_select_group_line').append('<option value="' + data[i].LineGroup_UID + '">' + data[i].LineName + '</option>');
                    }
                }
                $('#js_m_select_group_line').selectpicker('refresh');
                $('#js_s_select_group_line').selectpicker('refresh');
            });

            //子線資料載入getSubLine
            //var get_sub_line_url = LineGroupUrls.getSubLine;
            //$.post(get_sub_line_url, function (data) {
            //    $('#js_s_select_sub_line').html('<option></option>');
            //    for (var i = 0; i < data.length; i++) {
            //        //子線頁
            //        if ($('#js_s_select_sub_line').find('option[value=' + data[i].Line_ID + ']').length == 0) {
            //            $('#js_s_select_sub_line').append('<option value="' + data[i].Line_ID + '">' + data[i].LineName + '</option>');
            //        }
            //    }
            //    $('#js_s_select_sub_line').selectpicker('val', '');
            //});

            //存放子線名稱
            $('#js_s_select_sub_line').change(function () {
                $('#js_s_hidden_line_name').val($('#js_s_select_sub_line option:selected').text());
            })


            //查询按钮
            $('#js_btn_query').click(function () {

                if ($('#js_form_query').valid()) {
                    LineGroup.QueryGroupLines();
                    console.log('LineGroup.QueryGroupLines()');
                }
            });

            //新增儲存主線頁按钮
            $('#js_btn_save_new').click('click', function () {

                if ($.trim($('#js_select_factory').val()) === ''
                    || $.trim($('#js_select_op_type').val()) === ''
                    || $.trim($('#js_customerId').val()) === ''
                    || $.trim($('#js_input_group_line_name').val()) === '') {
                    PDMS.Utility.MessageBox.info("Please input right Factory,OP Type,Project,Group Line Name");

                } else {

                    if ($("#js_form_maintain").valid()) {
                        var submitJson = $('#js_form_maintain').serializeObject();

                        $.post(LineGroupUrls.addGroupLine, { jsonGroupLine: JSON.stringify(submitJson) }, function (data) {
                            if (data == 'SUCCESS') {
                                PDMS.Utility.MessageBox.info("Save Success");
                                $("#js_form_maintain input[type!='hidden']").val('');
                                LineGroup.QueryGroupLines();
                                $('#js_edit_modal').modal('hide');
                            } else {
                                PDMS.Utility.MessageBox.error(data);
                            }
                        });
                    }
                }
            });

            //編輯儲存主線頁按钮
            $('#js_btn_save_edit').click('click', function () {

                if ($.trim($('#js_select_factory').val()) === ''
                    || $.trim($('#js_select_op_type').val()) === ''
                    || $.trim($('#js_customerId').val()) === ''
                    || $.trim($('#js_input_group_line_name').val()) === '') {
                    PDMS.Utility.MessageBox.info("Please input right Factory,OP Type,Project,Group Line Name");

                } else {

                    if ($("#js_form_maintain").valid()) {
                        var submitJson = $('#js_form_maintain').serializeObject();

                        $.post(LineGroupUrls.modifyGroupLine, { jsonGroupLine: JSON.stringify(submitJson) }, function (data) {
                            if (data == 'SUCCESS') {
                                PDMS.Utility.MessageBox.info("Save Success");
                                $("#js_form_maintain input[type!='hidden']").val('');
                                LineGroup.QueryGroupLines();
                                $('#js_edit_modal').modal('hide');
                            } else {
                                PDMS.Utility.MessageBox.error(data);
                            }
                        });
                    }
                }
            });

            //新增儲存子線頁按钮
            $('#js_s_btn_save_new').click('click', function () {

                if ($.trim($('#js_s_select_factory').val()) === ''
                    || $.trim($('#js_s_select_op_type').val()) === ''
                    || $.trim($('#js_s_customerId').val()) === ''
                    || $.trim($('#js_s_select_group_line').val()) === ''
                    || $.trim($('#js_s_select_sub_line').val())==='') {
                    PDMS.Utility.MessageBox.info("Please input right Factory,OP Type,Project,Group Line,Sub Line");

                } else {

                    if ($("#js_form_s_maintain").valid()) {
                        var submitJson = $('#js_form_s_maintain').serializeObject();

                        $.post(LineGroupUrls.addSubToGroup, { jsonGroupLine: JSON.stringify(submitJson) }, function (data) {
                            if (data == 'SUCCESS') {
                                PDMS.Utility.MessageBox.info("Save Success");
                                $("#js_form_s_maintain input[type!='hidden']").val('');
                                LineGroup.QueryGroupLines();
                                $('#js_edit_s_modal').modal('hide');
                            } else {
                                PDMS.Utility.MessageBox.error(data);
                            }
                        });
                    }
                }
            });

            //編輯儲存子線頁按钮
            $('#js_s_btn_save_edit').click('click', function () {

                if ($.trim($('#js_s_select_factory').val()) === ''
                    || $.trim($('#js_s_select_op_type').val()) === ''
                    || $.trim($('#js_s_select_group_line').val()) === ''
                    || $.trim($('#js_s_select_sub_line').val()) === '') {
                    PDMS.Utility.MessageBox.info("Please input right Factory,OP Type,Group Line,Sub Line");

                } else {

                    if ($("#js_form_s_maintain").valid()) {
                        var submitJson = $('#js_form_s_maintain').serializeObject();

                        $.post(LineGroupUrls.modifyGroupLine, { jsonGroupLine: JSON.stringify(submitJson) }, function (data) {
                            if (data == 'SUCCESS') {
                                PDMS.Utility.MessageBox.info("Save Success");
                                $("#js_form_s_maintain input[type!='hidden']").val('');
                                LineGroup.QueryGroupLines();
                                $('#js_edit_s_modal').modal('hide');
                            } else {
                                PDMS.Utility.MessageBox.error(data);
                            }
                        });
                    }
                }
            });

            //#region Add/Edit model 出现和消失事件
            $('#js_edit_modal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget)
                var modal = $(this)
                var title = modal.find('.modal-title');

                if (button.attr('id') == 'js_btn_add_groupline') {

                    title.text("Add New Line Group");
                    $('#js_select_factory').removeAttr("disabled");
                    $('#js_select_factory').selectpicker('val', '');
                    $('#js_select_op_type').html('<option></option>');
                    $('#js_select_op_type').selectpicker('refresh');
                    $('#js_select_op_type').removeAttr("disabled");
                    $('#js_select_fun_plant').html('<option></option>');
                    $('#js_select_fun_plant').selectpicker('refresh');
                    $('#js_select_group_line').removeAttr("disabled");
                    $('#js_edit_modal').find('input').val('');
                    $('#js_btn_save_edit').hide();
                    $('#js_btn_save_new').show();
                    $('#js_hidden_line_group_uid').val(0);
                    $('.list-group.validate-error').empty();
                }
            })
            //#endregion

            //#region Add/Edit model 新增子產線出现和消失事件
            $('#js_edit_s_modal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget)
                var modal = $(this)
                var title = modal.find('.modal-title');

                if (button.attr('id') == 'js_btn_add_subline') {

                    title.text("Add New Sub Line Group");
                    $('#js_s_select_factory').selectpicker('val', '');
                    $('#js_s_select_factory').removeAttr("disabled");
                    $('#js_s_select_op_type').html('<option></option>');
                    $('#js_s_select_op_type').selectpicker('refresh');
                    $('#js_s_select_op_type').removeAttr("disabled");
                    $('#js_s_select_fun_plant').html('<option></option>');
                    $('#js_s_select_fun_plant').selectpicker('refresh');
                    $('#js_s_select_group_line').removeAttr("disabled");
                    $('#js_s_select_group_line').html('<option></option>');
                    $('#js_s_select_group_line').selectpicker('refresh');
                    $('#js_s_customerId').removeAttr("disabled");
                    $('#js_s_customerId').html('<option></option>');
                    $('#js_s_customerId').selectpicker('refresh');
                    $('#js_s_btn_save_edit').hide();
                    $('#js_s_btn_save_new').show();
                    $('#js_s_hidden_line_group_uid').val(0);
                    $('#js_s_hidden_line_name').val("");
                    $('.list-group.validate-error').empty();
                }
            })
            //#endregion

            //Grid中编辑按钮
            $('body').on('click', '.js-grid-edit', function () {

                var uid = $(this).data('id'),
                    url = LineGroupUrls.queryGroupLine;
                $.post(url, { uid: uid }, function (data) {
                    if (data.LineParent_ID == null) {
                        var title = $('#js_edit_modal').find('.modal-title');
                        title.text("Edit Line Group");
                        $('#js_select_factory').selectpicker('refresh')
                        $('#js_select_factory').selectpicker('val', data.Plant_Organization_UID);
                        $('#js_select_factory').trigger('change');
                        $('#js_select_factory').attr('disabled', true);
                        if ($('#js_select_op_type').find('option[value=' + data.BG_Organization_UID + ']').length == 0) {
                            $('#js_select_op_type').append('<option value="' + data.BG_Organization_UID + '">' + data.op_Type + '</option>');
                        }
                        $('#js_select_op_type').selectpicker('refresh')
                        $('#js_select_op_type').selectpicker('val', data.BG_Organization_UID);
                        $('#js_select_op_type').trigger('change');
                        $('#js_select_op_type').attr('disabled', true);
                        if (data.FunPlant_Organization_UID != null) {
                            if ($('#js_select_fun_plant').find('option[value=' + data.FunPlant_Organization_UID + ']').length == 0) {
                                $('#js_select_fun_plant').append('<option value="' + data.FunPlant_Organization_UID + '">' + data.funPlant + '</option>');
                            }
                            $('#js_select_fun_plant').selectpicker('refresh')
                            $('#js_select_fun_plant').selectpicker('val', data.FunPlant_Organization_UID);
                        }
                        $('#js_hidden_line_group_uid').val(uid);
                        $('#js_input_group_line_name').removeAttr("disabled");
                        $('#js_input_group_line_name').val(data.LineName);
                        $('#js_btn_save_edit').show();
                        $('#js_btn_save_new').hide();
                        $('#js_edit_modal').modal('show');
                    }
                    else
                    {
                        var title = $('#js_edit_s_modal').find('.modal-title');
                        title.text("Edit SubLine");
                        $('#js_s_select_factory').selectpicker('refresh')
                        $('#js_s_select_factory').selectpicker('val', data.Plant_Organization_UID);
                        $('#js_s_select_factory').trigger('change');
                        $('#js_s_select_factory').attr('disabled', true);
                        $('#js_s_select_op_type').append('<option value="' + data.BG_Organization_UID + '">' + data.op_Type + '</option>');
                        $('#js_s_select_op_type').selectpicker('refresh')
                        $('#js_s_select_op_type').selectpicker('val', data.BG_Organization_UID);
                        $("#js_s_select_op_type").trigger("change");
                        $('#js_s_select_op_type').attr('disabled', true);
                        if (data.FunPlant_Organization_UID != null) {
                            $('#js_s_select_fun_plant').append('<option value="' + data.FunPlant_Organization_UID + '">' + data.funPlant + '</option>');
                            $('#js_s_select_fun_plant').selectpicker('refresh')
                            $('#js_s_select_fun_plant').selectpicker('val', data.FunPlant_Organization_UID);
                        }
                        $('#js_s_hidden_line_group_uid').val(uid);
                        if ($('#js_s_select_group_line').find('option[value=' + data.LineParent_ID + ']').length == 0) {
                            $('#js_s_select_group_line').append('<option value="' + data.LineParent_ID + '">' + data.LineParent_Name + '</option>');
                        }
                        $('#js_s_select_group_line').selectpicker('refresh')
                        $('#js_s_select_group_line').selectpicker('val', data.LineParent_ID);
                        $('#js_s_hidden_line_name').val(data.LineName);
                        if ($('#js_s_select_sub_line').find('option[value=' + data.LineID + ']').length == 0) {
                            $('#js_s_select_sub_line').append('<option value="' + data.LineID + '">' + data.LineName + '</option>');
                        }
                        $('#js_s_select_group_line').attr('disabled', true);
                        $('#js_s_select_sub_line').removeAttr("disabled");
                        $('#js_s_select_sub_line').selectpicker('refresh')
                        $('#js_s_select_sub_line').selectpicker('val', data.LineID);
                        
                        $('#js_s_customerId').append('<option value="' + data.CustomerID + '">' + data.Project_Name + '</option>');
                        $('#js_s_customerId').selectpicker('refresh')
                        $('#js_s_customerId').selectpicker('val', data.CustomerID);
                        $("#js_s_customerId").trigger("change");
                        $('#js_s_customerId').attr('disabled', true);
                        $('#js_s_btn_save_edit').show();
                        $('#js_s_btn_save_new').hide();
                        $('#js_edit_s_modal').modal('show');
                    }
                });


            });

            //Grid中Delete按钮
            $('body').on('click', '.js-grid-delete', function () {

                var uid = $(this).data('id');

                PDMS.Utility.MessageBox.confirm(
                    "Are you sure to delete this item?"
                    , function () {
                        var url = LineGroupUrls.removeGroupLine;
                        $.post(url, { uid: uid }, function (data) {
                            if (data == 'SUCCESS') {
                                PDMS.Utility.MessageBox.info("Delete Success");
                                LineGroup.QueryGroupLines();
                            } else {
                                PDMS.Utility.MessageBox.error(data);
                            }
                        });
                    });
            });

            //Grid中View按钮
            $('body').on('click', '.js-grid-view', function () {

                var uid = $(this).data('id'),
                    url = LineGroupUrls.queryGroupLine;
                $.post(url, { uid: uid }, function (data) {
                    if (data.LineParent_ID == null) {
                        var title = $('#js_edit_modal').find('.modal-title');
                        title.text("Edit Line Group");
                        $('#js_select_factory').selectpicker('refresh')
                        $('#js_select_factory').selectpicker('val', data.Plant_Organization_UID);
                        $('#js_select_factory').trigger('change');
                        $('#js_select_factory').attr('disabled', true);
                        if ($('#js_select_op_type').find('option[value=' + data.BG_Organization_UID + ']').length == 0) {
                            $('#js_select_op_type').append('<option value="' + data.BG_Organization_UID + '">' + data.op_Type + '</option>');
                        }
                        $('#js_select_op_type').selectpicker('refresh')
                        $('#js_select_op_type').selectpicker('val', data.BG_Organization_UID);
                        $('#js_select_op_type').trigger('change');
                        $('#js_select_op_type').attr('disabled', true);
                        if (data.FunPlant_Organization_UID != null) {
                            if ($('#js_select_fun_plant').find('option[value=' + data.FunPlant_Organization_UID + ']').length == 0) {
                                $('#js_select_fun_plant').append('<option value="' + data.FunPlant_Organization_UID + '">' + data.funPlant + '</option>');
                            }
                            $('#js_select_fun_plant').selectpicker('refresh')
                            $('#js_select_fun_plant').selectpicker('val', data.FunPlant_Organization_UID);
                        }
                        $('#js_hidden_line_group_uid').val(uid);
                        $('#js_input_group_line_name').val(data.LineName);
                        $('#js_input_group_line_name').attr('disabled', true);
                        $('#js_btn_save_edit').hide();
                        $('#js_btn_save_new').hide();
                        $('#js_edit_modal').modal('show');
                    }
                    else {
                        var title = $('#js_edit_s_modal').find('.modal-title');
                        title.text("Edit SubLine");
                        $('#js_s_select_factory').selectpicker('refresh')
                        $('#js_s_select_factory').selectpicker('val', data.Plant_Organization_UID);
                        $('#js_s_select_factory').trigger('change');
                        $('#js_s_select_factory').attr('disabled', true);
                        $('#js_s_select_op_type').append('<option value="' + data.BG_Organization_UID + '">' + data.op_Type + '</option>');
                        $('#js_s_select_op_type').selectpicker('refresh')
                        $('#js_s_select_op_type').selectpicker('val', data.BG_Organization_UID);
                        $("#js_s_select_op_type").trigger("change");
                        $('#js_s_select_op_type').attr('disabled', true);
                        if (data.FunPlant_Organization_UID != null) {
                            $('#js_s_select_fun_plant').append('<option value="' + data.FunPlant_Organization_UID + '">' + data.funPlant + '</option>');
                            $('#js_s_select_fun_plant').selectpicker('refresh')
                            $('#js_s_select_fun_plant').selectpicker('val', data.FunPlant_Organization_UID);
                        }
                        $('#js_s_hidden_line_group_uid').val(uid);
                        if ($('#js_s_select_group_line').find('option[value=' + data.LineParent_ID + ']').length == 0) {
                            $('#js_s_select_group_line').append('<option value="' + data.LineParent_ID + '">' + data.LineParent_Name + '</option>');
                        }
                        $('#js_s_select_group_line').selectpicker('refresh')
                        $('#js_s_select_group_line').selectpicker('val', data.LineParent_ID);
                        $('#js_s_select_group_line').attr('disabled', true);
                        $('#js_s_hidden_line_name').val(data.LineName);
                        if ($('#js_s_select_sub_line').find('option[value=' + data.LineID + ']').length == 0) {
                            $('#js_s_select_sub_line').append('<option value="' + data.LineID + '">' + data.LineName + '</option>');
                        }
                        $('#js_s_select_sub_line').selectpicker('refresh')
                        $('#js_s_select_sub_line').selectpicker('val', data.LineID);
                        $('#js_s_select_sub_line').attr('disabled', true);
                        $('#js_s_btn_save_edit').hide();
                        $('#js_s_btn_save_new').hide();
                        $('#js_edit_s_modal').modal('show');
                    }
                });
            });

        });
    </script>
}