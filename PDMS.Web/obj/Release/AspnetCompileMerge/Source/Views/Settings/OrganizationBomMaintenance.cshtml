<!-- Main content -->
<section class="content portal-content">

    <!--次標題 與 搜尋-->
    <div class="row">
        <!--次標題與Search keyword-->
        <div class="col-md-12 col-lg-9">
            <h4 class="margin-td-5" id="js_search_keywords"></h4>
        </div><!-- /col-次標題與Search keyword -->
        <!--col-右方搜尋與功能按鈕列-->
        <div class="col-md-12 search-field col-lg-3">

            <a class="btn btn-primary btn-sm" data-toggle="modal" data-target="#js_search_modal" id="js_btn_search"><i class="fa fa-search"></i> Search</a>
            <a class="btn btn-primary btn-sm" role="button" id="js_btn_add_orgbom">
                <i class="fa fa-plus"></i> Add
            </a>
            <a id="js_btn_export" class="btn btn-primary btn-sm" role="button">
                <i class="glyphicon glyphicon-save"></i> Export
            </a>
        </div><!-- /col-右方搜尋與功能按鈕列-->
    </div><!--/次標題 與 搜尋-->
    <hr class="hr-custom">

    <!--row Search Keyword collapse-->
    <div class="row">
        <div class="col-xs-12" id="js_criteria_alert_cnt">
        </div>
    </div> <!--/row Search Keyword collapse-->
    <!--內容 表格列-->
    <div class="row">
        <!--表格-->
        <div class="col-md-12 table-container">
            <table class="table table-striped table-hover table-condensed nowrap" id="js_plant_datatable">
                <thead>
                    <tr>
                        <th class="table-col-checkbox nosort">
                            <input type="checkbox" class="js-checkbox-all" />
                        </th>
                        <th class="table-col-seq nosort">Seq</th>
                        <th class="table-col-action nosort">Action</th>

                        <th>Parent Organization ID</th>
                        <th>Parent Organization Name</th>
                        <th>Order Index</th>
                        <th>Child Organization ID</th>
                        <th>Child Organization Name</th>

                        <th>Begin Date</th>
                        <th>End Date</th>
                        <th>Modified User</th>
                        <th>Modified Date</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th class="table-col-checkbox nosort"></th>
                        <th class="table-col-seq nosort">Seq</th>
                        <th class="table-col-action nosort">Action</th>

                        <th>Parent Organization ID</th>
                        <th>Parent Organization Name</th>
                        <th>Order Index</th>
                        <th>Child Organization ID</th>
                        <th>Child Organization Name</th>

                        <th>Begin Date</th>
                        <th>End Date</th>
                        <th>Modified User</th>
                        <th>Modified Date</th>
                    </tr>
                </tfoot>
            </table>
            <div id="page" class="row"></div>

        </div><!--/表格-->
    </div><!-- / 內容 表格列 -->


</section><!-- /.content -->
@section ViewModals{
    <div class="modal fade" id="js_search_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Search</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <form id="js_form_query" class="form-horizontal" data-need-validate="true">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_s_input_plant">Parent Org ID</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="ParentOrg_ID" class="form-control input-sm" id="js_s_input_plant" placeholder="Parent Organization ID">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label no-padding-l" for="js_s_input_location">Parent Org Name</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="ParentOrg_Name" class="form-control input-sm" id="js_s_input_location" placeholder="Parent Organization Name">
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_s_input_plant_code">Child Org ID</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="ChildOrg_ID" class="form-control input-sm" id="js_s_input_plant_code" placeholder="Child Organization ID">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_s_input_plant_name_zh">Child Org Name</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="ChildOrg_Name" class="form-control input-sm" id="js_s_input_plant_name_zh" placeholder="Child Organization Name">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_s_input_reference_date">Reference Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            <input type="text" name="Reference_Date" class="form-control input-sm date" id="js_s_input_reference_date" value="@DateTime.Now.ToString("yyyy-MM-dd")">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" data-type="radio" data-for-name="query_types">Query Types</label>
                                    <div class="col-sm-8 search-radio-cnt">
                                        <label class="radio-inline"><input type="radio" name="query_types" id="js_s_radio_valid" value="0" checked> Valid</label>
                                        <label class="radio-inline"><input type="radio" name="query_types" id="js_s_radio_invalid" value="1"> Invalid</label>
                                        <label class="radio-inline"><input type="radio" name="query_types" id="js_s_radio_all" value="2"> All</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_s_input_modified_by_ntid">Modified By</label>
                                    <div class="col-sm-8">
                                        <input type="text" name="Modified_By_NTID" class="form-control input-sm" id="js_s_input_modified_by_ntid" placeholder="Modified By(NTID)">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" data-type="date-interval">Modified Date</label>
                                    <div class="col-sm-8">
                                        <div class="input-group">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            <span class="input-group-addon">From</span>
                                            <input type="text" name="Modified_Date_From" class="form-control input-sm date" id="js_s_input_modified_from">
                                            <span class="input-group-addon">To</span>
                                            <input type="text" name="Modified_Date_End" class="form-control input-sm date" id="js_s_input_modified_to">
                                        </div>
                                    </div>
                                </div>
                            </div>  
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="js_btn_clear" type="button" class="btn btn-primary btn-sm"><i class="fa fa-eraser"></i> Clear</button>
                    <button id="js_btn_query" type="button" class="btn btn-primary btn-sm"><i class="fa fa-search"></i> Query</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="js_edit_modal" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Maintain OrganizationBom</h4>
                </div>
                <form id="js_form_plant_edit" class="form-horizontal">
                    <div class="modal-body">
                        <div class="row">
                            <input type="hidden" id="js_hidden_organizationbom_uid" name="OrganizationBOM_UID" />
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label" for="js_input_parentorg">Parent Organization</label>
                                    <div class="col-sm-8">
                                        <select class="form-control input-sm js-select2-org" id="js_select2_parentorg" name="ParentOrg_UID" style="width:100%"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label" for="js_select2_childorg_id">Child Organization</label>
                                    <div class="col-sm-8">
                                        <select class="form-control input-sm js-select2-org" id="js_select2_childorg" name="ChildOrg_UID" style="width:100%"
                                                required data-msg-required="Please enter a corrent Child Organization"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_input_begin_date">Begin Date</label>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            <input type="text" name="Begin_Date" class="form-control input-sm date-from-today date  " id="js_input_begin_date"  data-rule-date="true"
                                                   required data-msg-required="Please enter Begin Date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="js_input_end_date">End Date</label>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            <input type="text" name="End_Date" class="form-control input-sm date-from-today date " id="js_input_end_date" data-rule-date="true">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-6 control-label" for="js_input_order_index">Order Index</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control input-sm" id="js_input_order_index" name="Order_Index" placeholder="Order Index"
                                               data-rule-digits="true" data-rule-min="1" data-msg-min="Order Indext must greater than 0"
                                               required data-msg-required="Please enter Order Index">
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="isEdit" value="false" />
                            <!--jquery validata error container-->
                            <div class="col-xs-12"><ul class="list-group validate-error"></ul></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary btn-sm" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</button>
                        <button type="button" class="btn btn-primary btn-sm" id="js_btn_save_new_OrgBom"><i class="fa fa-save"></i> Save</button>
                        <button type="button" class="btn btn-primary btn-sm" id="js_btn_save_edit_OrgBom"><i class="fa fa-save"></i> Edit Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

@section ViewScripts{
    <script type="text/javascript">
        $(function () {

            //#endregion
            var OrgBomMaintenance = (function () {
                var needBuildCriteria = false;
                var urls =
                    {
                        EditOrgBom: '@Url.Action("EditOrgBom", "Settings")',
                        AddOrgBom: '@Url.Action("AddOrgBom", "Settings")',
                        queryOrgBoms: '@Url.Action("QueryOrgBoms", "Settings")',
                        queryOrgBom: '@Url.Action("QueryOrgBom", "Settings")',
                        checkOrgBomExist: '@Url.Action("CheckOrgBomExist","Settings")',
                        GetOrgInfo: '@Url.Action("GetOrgInfoByOrg", "Settings")',
                        exportOrgBoms: '@Url.Action("DoExportOrgBom", "Settings")'
                    };
                var columns = [
                    {
                        createdCell: function (td, cellData, rowData, row, col) {
                            $(td).html('<input type="checkbox" name="cktrans" class="js-checkbox-item" value="' + rowData.OrganizationBOM_UID + '">')
                                 .addClass('table-col-checkbox');
                        },
                        className: "text-center"
                    }, {
                        data: null,
                        className: "table-col-seq"
                    }, {
                        createdCell: function (td, cellData, rowData, row, col) {
                            var disableEdit = false;
                            if (rowData.End_Date !== null && moment().startOf('day').isAfter(rowData.End_Date)) {
                                disableEdit = true;
                            }

                            $(td).html('<button class="btn btn-primary btn-xs" rel="action-popover">' +
                                            '<i class="fa fa-reorder"></i>' +
                                        '</button>' +
                                        '<div class="hidden popover-content">' +
                                            '<button type="button" class="btn btn-primary btn-xs js-grid-edit ' + (disableEdit ? "disabled" : "") + '" data-id="' + rowData.OrganizationBOM_UID + '">Edit</button> ' +
                                        '</div>');
                        },
                        className: "text-center"
                    }, {
                        data: "ParentOrg_ID",
                        className: "min-col-xs"
                    }, {
                        data: "Parent_Organization_Name",
                        className: "min-col-xs"
                    }, {
                        data: "Order_Index",
                        className: "min-col-xs"
                    }, {
                        data: "ChildOrg_ID",
                        className: "min-col-xs"
                    }, {
                        data: "Child_Organization_Name",
                        className: "min-col-xs"
                    }, {
                        data: "Begin_Date",
                        className: "min-col-xs"
                    }, {
                        data: "End_Date",
                        className: "min-col-xs"
                    }, {
                        data: "Modified_UserName",
                        className: "min-col-lg"
                    }, {
                        data: "Modified_Date",
                        className: "min-col-lg"
                    }];

                var _getParams = function () {

                    if (needBuildCriteria) {
                        return $('#js_form_query').serialize().replace(/\+/g, " ");
                    } else {
                        return null;
                    }
                };

                var _queryPlants = function (firstLoad) {

                    var config = {
                        pageId: "#page",
                        tableId: "#js_plant_datatable",
                        remoteUrl: urls.queryOrgBoms,
                        searchParams: _getParams(),
                        tableOptions: {
                            columns: columns,
                            scrollX: true,
                            scrollCollapse: false,
                            autoWidth: true,
                        }
                    };

                    if (!firstLoad) {
                        $('#page').page('destroy');
                    }

                    if (needBuildCriteria) {
                        PDMS.Utility.Criteria.Build();
                    }

                    PDMS.Utility.Pages.Set(config);
                };

                return {
                    urls: urls,
                    Init: function () {

                        //页面初始化加载查询时，初始化Criteria
                        PDMS.Utility.Criteria.Init();
                        _queryPlants(true);
                    },
                    queryOrgBoms: function (isSearchBtn) {

                        needBuildCriteria = (isSearchBtn === true ? true : needBuildCriteria);
                        _queryPlants(false);
                    }
                }

            })();

            OrgBomMaintenance.Init();

            $('#js_btn_query').click(function () {

                if ($("#js_form_query").valid()) {

                    OrgBomMaintenance.queryOrgBoms(true);
                    $('#js_search_modal').modal('hide');
                }
            });

            //clear query conditions in search modal
            $('#js_btn_clear').click(function () {

                PDMS.Utility.Criteria.Clear(function () {
                    $("#js_s_input_reference_date").val(moment().format("YYYY-MM-DD"));
                    $("#js_s_radio_valid").prop('checked', true);
                });
            });

            $('#js_btn_export').click(function () {
                var $selectList = $('#js_plant_datatable').find('.js-checkbox-item:checked');
                var len = $selectList.length;
                if (len == 0) {
                    PDMS.Utility.MessageBox.info('please select datas to export!');
                } else {
                    var uids = $.map($selectList, function (row) {
                        return row.value;
                    });
                    var url = OrgBomMaintenance.urls.exportOrgBoms;
                    url += "?uids=" + uids.toString();
                    window.location.href = url;
                }
            });

            //#region extra configuration of validate in add/edit model, others via data-attribute
            $('#js_form_plant_edit').validate({
                errorContainer: $('ul.validate-error'),
                errorLabelContainer: $('#js_edit_modal ul.validate-error'),
                wrapper: 'li'
            });

            $('#js_input_end_date').rules('add', {
                StartDateGTEnd: "#js_input_begin_date",
                messages: { StartDateGTEnd: PDMS.Utility.Settings.ValidateMessage.twoDateError }
            });
            //#endregion

            //do clean up in edit modal show/hide
            $('#js_edit_modal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget)
                var modal = $(this)
                var title = modal.find('.modal-title');

                if (button.attr('id') === 'js_btn_add_orgbom') {

                    title.text("Add OrganizationBom");
                    $('#js_btn_save_new_OrgBom').show();
                    $('#js_btn_save_edit_OrgBom').hide();
                    $('#js_input_begin_date').attr("disabled", false);
                    $('#js_input_end_date').attr("disabled", false);
                }

                if (button.hasClass('js-grid-edit')) {

                    title.text("Edit OrganizationBom");

                    $('#js_btn_save_new_OrgBom').hide();
                    $('#js_btn_save_edit_OrgBom').show();
                }
            })

            $('#js_edit_modal').on('hidden.bs.modal', function (e) {
                $('#js_edit_modal').find('input').val('');
                $('.list-group.validate-error').empty();
            });

            //新增保存OrgBom按钮
            $("#js_btn_save_new_OrgBom").click('click', function () {

                var targetForm = $('#js_form_plant_edit');

                if (targetForm.valid()) {

                    var submitJson = targetForm.serializeObject();
                    submitJson.OrganizationBOM_UID = 0;

                    if (SaveCheck(submitJson)) {

                        $.post(OrgBomMaintenance.urls.AddOrgBom, { jsonAddOrgBom: JSON.stringify(submitJson) }, function (data) {
                            if (data == 'SUCCESS') {
                                PDMS.Utility.MessageBox.info("Add Organization Bom Success");
                                targetForm.find('input').val("");
                                $('.js-select2-org').val('').trigger('change').removeData("begindate enddate").removeAttr("data-begindate data-enddate");
                            } else {
                                PDMS.Utility.MessageBox.error(data);
                            }
                        });
                    }
                }
            });

            //新增修改OrgBom按钮
            $("#js_btn_save_edit_OrgBom").click('click', function () {

                var targetForm = $('#js_form_plant_edit');

                if (targetForm.valid()) {

                    var submitJson = targetForm.serializeObject();

                    if (SaveCheck(submitJson)) {
                        $.post(OrgBomMaintenance.urls.EditOrgBom, { jsonEditOrgBom: JSON.stringify(submitJson) }, function (data) {
                            if (data == 'SUCCESS') {
                                PDMS.Utility.MessageBox.info("Edit Organization Bom Success");
                                OrgBomMaintenance.queryOrgBoms();
                                $('#js_edit_modal').modal('hide');
                            } else {
                                PDMS.Utility.MessageBox.error(data);
                            }
                        });
                    }
                }
            });

            function SaveCheck(submitJson) {
                var $elParentOrg = $('#js_select2_parentorg');
                var $elChildOrg = $('#js_select2_childorg');
                var uid = submitJson.OrganizationBOM_UID;
                var parentUId = submitJson.ParentOrg_UID === undefined ? ($elParentOrg.val() === null ? 0 : $elParentOrg.val()) : submitJson.ParentOrg_UID;
                var childUId = submitJson.ChildOrg_UID === undefined ? $elChildOrg.val() : submitJson.ChildOrg_UID;
                var uniqueCheck = true;
                //check unique
                $.ajax({
                    type: "get",
                    url: OrgBomMaintenance.urls.checkOrgBomExist,
                    data: { uid: uid, parentUId: parentUId, childUId: childUId, index: submitJson.Order_Index },
                    async: false,
                    success: function (response) {

                        if (response) {
                            PDMS.Utility.MessageBox.error("Record with same parent org, child org and order index is exist");
                            uniqueCheck = false;
                        }
                    }
                });

                if (!uniqueCheck) { return false; };

                //check date
                var beginDate = $('#js_input_begin_date').val();
                if (!$('#js_input_begin_date').prop('disabled') && moment(beginDate).diff(moment(), 'days') < 0) {
                    PDMS.Utility.MessageBox.error('Begin Date should equal or greater than today');
                    return false;
                }

                var inputEnddate = $('#js_input_end_date').val();
                var endDate = inputEnddate === "" ? null : inputEnddate;
                if (endDate !== null && !$('#js_input_end_date').prop('disabled') && moment(endDate).diff(moment(), 'days') < 0) {
                    PDMS.Utility.MessageBox.error('End Date should equal or greater than today');
                    return false;
                }

                if (parentUId > 0) {
                    var validDate = $elParentOrg.data('validDate');
                    var target = { begindate: validDate.begindate, enddate: validDate.enddate };
                    if (target.enddate === undefined) {
                        target.enddate = null;
                    }

                    var dateValidate = PDMS.Utility.Tools.DateCompareInterval(
                                            { name: "Orgnization", beginDate: target.begindate, endDate: target.enddate },
                                            { name: "Orgnization BOM", beginDate: beginDate, endDate: endDate },
                                            "Date not valid in parent organization "
                                        );
                    if (!dateValidate) { return false; }
                }

                if (submitJson.ChildOrg_UID !== "") {

                    var validDate = $elChildOrg.data('validDate');
                    var target = { begindate: validDate.begindate, enddate: validDate.enddate };
                    if (target.enddate === undefined) {
                        target.enddate = null;
                    }

                    var dateValidate = PDMS.Utility.Tools.DateCompareInterval(
                                            { name: "Orgnization", beginDate: target.begindate, endDate: target.enddate },
                                            { name: "Orgnization BOM", beginDate: beginDate, endDate: endDate },
                                            "Date not valid in child organization "
                                        );
                    if (!dateValidate) { return false; }
                }

                return true;
            }

            //edit button in grid
            $('body').on('click', '.js-grid-edit', function () {

                var $sender = $(this);
                if ($sender.hasClass('disabled')) {
                    PDMS.Utility.MessageBox.error("Organization BOM already expired, can't edit!");
                    return;
                }

                var uid = $(this).data('id'),
                    url = OrgBomMaintenance.urls.queryOrgBom;

                $.post(url, { uid: uid }, function (data) {

                    $('#js_hidden_organizationbom_uid').val(uid);
                    ResetOrgSelect2();

                    var childOrg = $("#js_select2_childorg");
                    childOrg
                        .append('<option value="' + data.ChildOrg_UID + '">' + PDMS.Utility.Tools.FormatString(orgFormatString, [data.ChildOrg_ID, data.Child_Organization_Name]) + '</option>')
                        .data("validDate", { "begindate": data.ChildOrg_BeginDate, "enddate": data.ChildOrg_EndDate });

                    var parentOrg = $('#js_select2_parentorg');

                    if (data.ParentOrg_UID !== null) {
                        parentOrg
                            .data("validDate",{ "begindate": data.ParentOrg_BeginDate, "enddate": data.ParentOrg_EndDate })
                            .append('<option value="' + data.ParentOrg_UID + '">' + PDMS.Utility.Tools.FormatString(orgFormatString, [data.ParentOrg_ID, data.Parent_Organization_Name]) + '</option>')
                    }
                    InitOrgSelect2();

                    $('#js_input_order_index').val(data.Order_Index);
                    $('#js_input_begin_date').val(data.Begin_Date);
                    $('#js_input_end_date').val(data.End_Date);

                    $('#js_input_begin_date').attr("disabled", true);
                    $('#js_input_end_date').attr("disabled", data.End_Date !== null);
                });

                $('#js_edit_modal').modal('show', $(this));
            });

            $('#js_btn_add_orgbom').click(function () {
                ResetOrgSelect2();
                InitOrgSelect2();
                $('#js_edit_modal').modal('show', $(this));
            })

            var orgFormatString = "[Org ID]{0}  /  [Org Name]{1}";
            var orgSelect2Option = {
                placeholder: "Enter organization id and pick one as you need",
                allowClear: true,
                ajax: {
                    url: OrgBomMaintenance.urls.GetOrgInfo,
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            Org: params.term
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: $.map(data, function (item) {
                                return {
                                    text: PDMS.Utility.Tools.FormatString(orgFormatString, [item.Organization_ID, item.Organization_Name]),
                                    id: item.Organization_UID,
                                    element: { begindate: item.Begin_Date, enddate: item.End_Date }
                                }
                            })
                        };
                    },
                    cache: false
                },
                minimumInputLength: 1
            };

            
            function InitOrgSelect2() {
                $(".js-select2-org")
                    .on("select2:select", function (e) {
                        var appendData = e.params.data.element;
                        $(this).data("validDate", { "begindate": appendData.begindate, "enddate": appendData.enddate });
                    })
                    .on("select2:unselect", function (e) {
                        $(this).removeData("validDate");
                    })
                    .select2(orgSelect2Option);
            };

            function ResetOrgSelect2() {
                var $select2s = $(".js-select2-org");

                if ($("#js_select2_childorg").data('select2')) {
                    $select2s
                    .select2("destroy").find('option').remove();
                    $select2s.removeData("validDate");
                }
            };

        });
    </script>
}